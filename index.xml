<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title> </title>
<link>https://www.livefreeordichotomize.com/index.html</link>
<atom:link href="https://www.livefreeordichotomize.com/index.xml" rel="self" type="application/rss+xml"/>
<description>Live Free or Dichotomize: Lucy D&#39;Agostino McGowan &amp; Nick Strayer&#39;s Blog</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Fri, 04 Aug 2023 00:00:00 GMT</lastBuildDate>
<item>
  <title>Visual Diagnostic Tools for Causal Inference</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index.html</link>
  <description><![CDATA[ 




<p>Here we are going to look at several diagnostic plots are helpful when attempting to answer a causal question. They can be used to visualize the target population, balance, and treatment effect heterogeneity.</p>
<section id="setup" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>I’ve simulated data to demonstrate the utility of the various plots. In each simulation, we have four pre-treatment variables: <code>var1</code>, <code>var2</code>, <code>var3</code>, and <code>var4</code>, a treatment, <code>t</code>, and an outcome <code>y</code>. I have also fit a propensity score model for each and calculated ATE, ATT, and overlap weights (unsure what these are? <a href="https://livefreeordichotomize.com/posts/2019-01-17-understanding-propensity-score-weighting/">Check out this post on propensity score weighting</a>). I will also create three propensity score matched cohorts, each with a different caliper.</p>
<p>I use the following packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(propensity)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(halfmoon)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MatchIt)</span></code></pre></div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>For brevity I’ve hidden the simulation code, but if you would like to see it to reproduce the analyses yourself, just click the <strong>Code</strong> toggle.</p>
</div></div><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb2-2">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Main Data ----</span></span>
<span id="cb2-5"></span>
<span id="cb2-6">var1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)</span>
<span id="cb2-7">var2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)</span>
<span id="cb2-8">var3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)</span>
<span id="cb2-9">var4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)</span>
<span id="cb2-10">e_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4)))</span>
<span id="cb2-11">t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, e_x)</span>
<span id="cb2-12">y1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n)</span>
<span id="cb2-13">y0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n)</span>
<span id="cb2-14">y_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> y1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> y0</span>
<span id="cb2-15">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb2-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y_obs,</span>
<span id="cb2-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(t), </span>
<span id="cb2-18">  var1, </span>
<span id="cb2-19">  var2,</span>
<span id="cb2-20">  var3,</span>
<span id="cb2-21">  var4</span>
<span id="cb2-22">)</span>
<span id="cb2-23"></span>
<span id="cb2-24">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> binomial) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-26">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>),</span>
<span id="cb2-27">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_ate</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb2-28">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ato =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_ato</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb2-29">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_att =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_att</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-30">  ) </span>
<span id="cb2-31"></span>
<span id="cb2-32">match_1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matchit</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caliper =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb2-33">match_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matchit</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caliper =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb2-34">match_3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matchit</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caliper =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>)</span>
<span id="cb2-35">matches <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_matches</span>(data, match_1, match_2, match_3)</span>
<span id="cb2-36"></span>
<span id="cb2-37"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Non-linear data ----</span></span>
<span id="cb2-38"></span>
<span id="cb2-39">e_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">I</span>(var4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">I</span>(var4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>))))</span>
<span id="cb2-40">t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, e_x)</span>
<span id="cb2-41"></span>
<span id="cb2-42">y1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4 </span>
<span id="cb2-43">y0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4</span>
<span id="cb2-44">y_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> y1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> y0</span>
<span id="cb2-45">data_nonlinear <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb2-46">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y_obs,</span>
<span id="cb2-47">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(t), </span>
<span id="cb2-48">  var1, </span>
<span id="cb2-49">  var2,</span>
<span id="cb2-50">  var3,</span>
<span id="cb2-51">  var4</span>
<span id="cb2-52">)</span>
<span id="cb2-53"></span>
<span id="cb2-54">data_nonlinear <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_nonlinear <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_nonlinear, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> binomial) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-56">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>),</span>
<span id="cb2-57">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_ate</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb2-58">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ato =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_ato</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb2-59">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_att =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_att</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-60">  ) </span>
<span id="cb2-61"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Positivity violation data ----</span></span>
<span id="cb2-62"></span>
<span id="cb2-63"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2186</span>)</span>
<span id="cb2-64">var4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)</span>
<span id="cb2-65">e_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var4 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> var4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> var4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)))</span>
<span id="cb2-66">t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, e_x)</span>
<span id="cb2-67"></span>
<span id="cb2-68">data_positivity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb2-69">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(t), </span>
<span id="cb2-70">  var1, </span>
<span id="cb2-71">  var2,</span>
<span id="cb2-72">  var3,</span>
<span id="cb2-73">  var4</span>
<span id="cb2-74">)</span>
<span id="cb2-75"></span>
<span id="cb2-76">data_positivity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_positivity <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-77">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">poly</span>(var4, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_positivity, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> binomial) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-78">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>),</span>
<span id="cb2-79">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_ate</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb2-80">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ato =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_ato</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb2-81">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_att =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_att</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-82">  ) </span></code></pre></div>
</details>
</div>
</section>
<section id="target-population" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="target-population">Target Population</h2>
<p>Targeting different causal estimands will yield different target populations (for a longer discussion of target populations <a href="https://livefreeordichotomize.com/posts/2019-01-17-understanding-propensity-score-weighting/">see this post</a> and check out <a href="TODO add link">this awesome pre-print by Noah Griefer and Liz Stuart</a>. For example, if you are interested in answering a question with the treated group in mind, an estimand that estimates the average treatment effect among the treated (ATT), will be appropriate. Targeting this estimand will lead to selecting unexposed individuals who match the characterstics of the treated population (whether via matching to these individuals or upweighting them in the sample). Mirrored histograms can be a nice way to visualize the distribution of your target population after incorporating the propensity score when either matching or weighting are used. These basic plots are simply histograms of the <em>propensity score</em>, stratified by exposure. “Mirroring” these histograms above and below the x-axis, can make it easier to compare regions of overlap.</p>
<section id="what-am-i-looking-for" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="what-am-i-looking-for">What am I looking for?</h3>
<ul>
<li><strong>Overlap</strong>: What is the degree of overlap between the exposure groups?</li>
<li><strong>Positivity violations</strong>: Does everyone have a non-zero probability of each level of exposure?</li>
<li><strong>Extreme weights</strong>: Are there any extreme weights that could induce finite sample bias / extreme variance?</li>
</ul>
<p>Let’s take a look at an example. We can use the <a href="https://r-causal.github.io/halfmoon/"><code>halfmoon</code></a> package to create these.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>The <code>cobalt</code> package is another excellent tool that can create many of these plots in R.</p>
</div></div><p>Below is the basic implementation of this mirrored histogram prior to incorporating the propensity score. On the top half of the visualization, we see the distribution of the propensity score in the treated group (blue); the bottom half displays the distribution among the controls (orange). Looking at this plot, I see good <em>overlap</em> (i.e.&nbsp;the two distributions overlap), and I do not see evidence of <em>positivity violations</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"control"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treated"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflower blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> abs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>,</span>
<span id="cb3-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treatment"</span>,</span>
<span id="cb3-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now let’s incorporate the propensity score. First, let’s see what this plot looks like if our target population is the <em>whole population</em>, meaning we are interested in estimate the ATE. I have added the following line of code to the <code>ggplot</code> layers below: <code>geom_mirror_histogram(bins = 30, aes(weight = w_ate), alpha = 0.5)</code>. Now, I can see the <em>pseudo-population</em> that is created after implementing the propensity score weight. Notice the shape of the distributions match between the two groups (this is what the ATE weight is trying to do!). Looking at the figure below, I also can conclude that there aren’t any <em>extreme weights</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> w_ate), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"control"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treated"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflower blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> abs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>,</span>
<span id="cb4-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treatment"</span>,</span>
<span id="cb4-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These plots can be useful as a pedagogical tool to give a sense for how the different target estimands lead to different target populations. For example, let’s see what the pseudo-population looks like after using the ATT weight. Notice in the figure below, the “weighted” pseudo-population in the treated arm exactly overlaps with the actual distribution of the treated observations – this is exactly what an ATT weight does, everyone in the treated population receives a weight of 1. Now look at the bottom half of the figure – the distribution of the propensity scores in the control group now matches that of the treated – in the regions were there are fewer treated observations, the control observations are down-weighted (where the propensity score is lower) and in the regions where there are more treated observations the control observations are up-weighted (where the propensity score is higher).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> w_att), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"control"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treated"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflower blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> abs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>,</span>
<span id="cb5-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treatment"</span>,</span>
<span id="cb5-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, let’s see how an overlap (ATO) weight compares. Notice in the figure below <em>all</em> observations appear to be down-weighted – the overlap weights are bounded by 0 and 1 (which means they have nice variance properties! There is no risk of having an extreme weight!). Also notice the shape of the distribution – it matches between the two groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> w_ato), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"control"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treated"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflower blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> abs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>,</span>
<span id="cb6-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treatment"</span>,</span>
<span id="cb6-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I like to compare the overlap weights to the distribution after matching with a caliper, as they are both use to estimate a similar estimand. Here, I have created three matched cohorts, each with an increasingly smaller caliper. We can think of matching as an extreme form of weighting, where the observation will receive a weight of 1 if they are in the cohort and 0 otherwise. Here, I have created a dataset called <code>matches</code> that has three columns with these indiciators <code>match_1</code>, <code>match_2</code>, and <code>match_3</code> (you can see the code above by clicking the <strong>Code</strong> toggle in the Setup section).</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Propensity score matching with a <em>caliper</em> means that you only consider matches within a pre-specified distance of each other. Smaller calipers will result in fewer matches.</p>
</div></div><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(matches, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> match_1), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"control"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treated"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflower blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> abs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>,</span>
<span id="cb7-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(matches, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> match_2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"control"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treated"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflower blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> abs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>,</span>
<span id="cb8-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(matches, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> match_3), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"control"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treated"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflower blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> abs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>,</span>
<span id="cb9-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For demonstration purposes, let’s see what one of these plots looks like in a dataset that doesn’t have perfect overlap. Whoa! Look at that weight in the figure below. This is an example where we see a possible <strong>positivity violation</strong> (some observations of propensity scores very close to 1) and <strong>extreme weights</strong> (check out that control with a weight &gt; 500!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data_positivity, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> w_ate), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"control"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treated"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflower blue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> abs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>,</span>
<span id="cb10-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="balance-visualization" class="level2">
<h2 class="anchored" data-anchor-id="balance-visualization">Balance visualization</h2>
<p>Ok, once we’ve checked out the target population, we can see how balanced the exposure groups are after incorporating the propensity score.</p>
<section id="what-am-i-looking-for-1" class="level3">
<h3 class="anchored" data-anchor-id="what-am-i-looking-for-1">What am I looking for?</h3>
<ul>
<li>balance (in the mean) between treatment groups</li>
<li>balance across the distribution (for continuous confounders)</li>
</ul>
</section>
<section id="balance-in-the-mean" class="level3">
<h3 class="anchored" data-anchor-id="balance-in-the-mean">Balance in the mean</h3>
<p>A common way to look at balance is the <em>standardized mean difference</em>. This will tell us whether the (standardized) means are balanced between the treatment groups (we often target an absolute standardized mean difference less than 0.1 as a rule of thumb). We can use the <code>tidy_smd</code> function to calculate the standardized mean differences between the exposure groups in our example dataset. Let’s see how they compare across the matched datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">matches_smd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_smd</span>(</span>
<span id="cb11-2">  matches,</span>
<span id="cb11-3">  var1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>var4,</span>
<span id="cb11-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.group =</span> t,</span>
<span id="cb11-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.wts =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(match_1, match_2, match_3)</span>
<span id="cb11-6">)</span></code></pre></div>
</div>
<p>A nice way to visualize these is a <em>Love Plot</em> (named for <a href="https://twitter.com/thomaselove">Thomas Love</a>, who was one of the first folks to use them). In the <code>halfmoon</code> package there is a <code>geom_love</code> that will help create this as a layer in a <code>ggplot</code>, or you can use the shorthand <code>love_plot</code>. Below we can see that all three matched sets achieve balance with respect to demonstrating standardized mean differences across all pre-treatment variables less than the rule of thumb (0.1). Each of the different “matches” denote a different caliper (from largest: <code>match_1</code> to smallest: <code>match_3</code>). We see here that using a smaller caliper seems to help balance <code>var2</code> at the expense of <code>var4</code> and <code>var1</code> compared to the larger calipers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(matches_smd, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(smd), variable, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> method, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> method)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_love</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Absolute standardized mean difference"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s look at another dataset. I have simulated data I am calling <code>data_nonlinear</code>. Let’s check out the Love Plot for this data. This time I will use our propensity score weights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">weighted_smd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_smd</span>(</span>
<span id="cb13-2">  data_nonlinear,</span>
<span id="cb13-3">  var1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>var4,</span>
<span id="cb13-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.group =</span> t,</span>
<span id="cb13-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.wts =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(w_ate, w_att, w_ato)</span>
<span id="cb13-6">)</span>
<span id="cb13-7"></span>
<span id="cb13-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(weighted_smd, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(smd), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> variable, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> method, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> method)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_love</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>   </span>
<span id="cb13-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Absolute standardized mean difference"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Great! Looks like any of our weighting choices will achieve balance on the mean. Check out the green line (the overlap weights) – the standardized mean differences are exactly 0! This is a feature of this weight, if the propensity score is fit using logistic regression, any variables included in the model will be perfectly balanced on the mean – COOL! BUT as you may have guessed by the name of this dataset, the mean does not tell the whole story. These variables are <em>continuous</em>, so being balanced on the mean does not guarantee that the whole distribution is balanced. To examine the distribution of a variable across treatment groups, we can use an empirical cumulative distribution plot.</p>
</section>
</section>
<section id="balance-across-the-distribution" class="level2">
<h2 class="anchored" data-anchor-id="balance-across-the-distribution">Balance across the distribution</h2>
<p>The <code>geom_ecdf</code> function in the <code>halfmoon</code> package allows for you to visualize weighted empirical CDFs. Let’s first look at the <em>unweighted</em> eCDF for <code>var4</code>. We are going to plot the range of <code>var4</code> values on the x-axis and the proportion of <code>var4</code> values that are less than the given x-value on the y-axis (the empirical CDF), stratified by treatment. Looking at the figure below, we see <em>gaps</em> between the lines (meaning the two lines to not overlap, implying that the distributions differ).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data_nonlinear, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> var4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ecdf</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion &lt;= x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now we can compare this to the <em>weighted</em> eCDF to see if the propensity score weighting improves the balance – I’ll use the overlap weights for demonstration purposes. Hmm. We can see in the plot below that the lines cross (they are balanced on the mean, we knew that from the Love Plot), but there are still pretty large gaps across other portions of the distribution. This suggests that there are some non-linear effects that the propensity score is failing to capture.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data_nonlinear, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> var4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ecdf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weights =</span> w_ato)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion &lt;= x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s try to refit our propensity score model with a spline on the <code>var4</code> variable, and then recreate our plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">data_nonlinear <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_nonlinear <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> var1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> var3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> splines<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(var4, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), </span>
<span id="cb16-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_nonlinear) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-4">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>),</span>
<span id="cb16-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ato =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_ato</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) </span>
<span id="cb16-6"></span>
<span id="cb16-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data_nonlinear, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> var4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ecdf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weights =</span> w_ato)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Proportion &lt;= x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Much better!</p>
</section>
<section id="heterogeneous-treatment-effect" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="heterogeneous-treatment-effect">Heterogeneous treatment effect</h2>
<p>Here is the last visual! This is a quick plot that can help explore possible treatment heterogeneity.</p>
<section id="what-am-i-looking-for-2" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="what-am-i-looking-for-2">What am I looking for?</h3>
<ul>
<li>Differences in the treatment effect across the covariate space</li>
</ul>
<p>In this example dataset, the average treatment effect is 0. Let’s show that. There are lots of ways to estimate this, for example, we can use the ATE weights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> w_ate)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ t, data = data, weights = w_ate)

Coefficients:
(Intercept)           t1  
   -0.02095     -0.05364  </code></pre>
</div>
</div>
<p>Awesome! Now let’s create a plot to see if this effect is constant across the covariate space. One way to summarize the “covariate space” is the propensity score! This simple plot has the propensity score on the x-axis and the outcome on the y-axis. We then stratify by the treatment and look at a smoothed line in both groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The lines cross! This indicates that there is treatment effect heterogeneity (in this particular case, when the propensity score is greater than 0.5, there is a positive treatment effect, and when less than 0.5 there is a negative treatment effect).</p>
<p>Just to see what it looks like when there is <em>not</em> a heterogeneous treatment effect, let’s check out the <code>data_nonlinear</code> dataset (where I simulated a constant effect). Notice below the lines don’t cross, the width between them is constant across the covariate space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data_nonlinear, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> t)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>



<div class="no-row-height column-margin column-container"><div class="">
<p>You can find a longer post about these plots <a href="https://livefreeordichotomize.com/posts/2023-07-26-visual-diagnostic-tool-for-causal-inference/">here</a>.</p>
</div></div></section>
</section>

 ]]></description>
  <category>rstats</category>
  <category>causal inference</category>
  <category>mirrored histograms</category>
  <category>balance</category>
  <category>propensity scores</category>
  <category>treatment effect heterogeneity</category>
  <guid>https://www.livefreeordichotomize.com/posts/2023-08-04-visual-diagnostic-tools-for-causal-inference/index.html</guid>
  <pubDate>Fri, 04 Aug 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Visual Diagnostic Tool for Causal Inference</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2023-07-26-visual-diagnostic-tool-for-causal-inference/index.html</link>
  <description><![CDATA[ 




<p>To celebrate the 40th anniversary of the paper <em>The Central Role of the Propensity Score in Observational Studies for Causal Effects</em> published in Biometrika in 1983, the journal Observational Studies had a special issue highlighting the methods in the paper and developed since. This led us to take a closer look at this seminal paper, and in doing so we noticed mention of a visual diagnostic tool that we haven’t see used often but might be useful for exploring potential treatment effect heterogeneity.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>We initially wrote this up as part of this special issue, you can find the paper here: D’Agostino McGowan, D’Agostino, and D’Agostino (2023) <a href="https://doi.org/10.1353/obs.2023.0008">doi.org/10.1353/obs.2023.0008</a>. Another special aspect of this paper is it is the first (and only!) paper I have written with both my father and grandfather ❤️</p>
</div></div><section id="whats-old-is-new" class="level2">
<h2 class="anchored" data-anchor-id="whats-old-is-new">What’s old is new!</h2>
<p>Here are the lines from the original paper:</p>
<blockquote class="blockquote">
<p>Since covariance adjustment is effectively adjustment for the linear discriminant, plots of the responses <img src="https://latex.codecogs.com/png.latex?r_%7B1i%7D"> and <img src="https://latex.codecogs.com/png.latex?r_%7B0i%7D"> or residuals <img src="https://latex.codecogs.com/png.latex?r_%7Bki%7D%20%E2%80%94%20%5Chat%7Br%7D_%7Bki%7D"> where <img src="https://latex.codecogs.com/png.latex?%5Chat%7Br%7D_%7Bki%7D"> is the value of <img src="https://latex.codecogs.com/png.latex?r_%7Bki%7D"> predicted from the regression model used in the covariance adjustment, versus the linear discriminant are useful in identifying nonlinear or nonparallel response surfaces, as well as extrapolations, which might distort the estimate of the average treatment effect. Furthermore, such a plot is a bivariate display of multivariate adjustment, and as such might be useful for general presentation.</p>
</blockquote>
<blockquote class="blockquote">
<p>Generally, plots of responses and residuals from covariance analysis against the propensity score <img src="https://latex.codecogs.com/png.latex?e(x)"> are more appropriate than against the discriminant, unless of course the covariates are multivariate normal with common covariance matrix in which case the propensity score is a monotone function of the discriminant.</p>
</blockquote>
<p>So simple! They are just suggesting for continuous outcomes plotting the outcome (or residuals) against the propensity score. If you use a linear discriminant to estimate the propensity score, this is basically a residuals vs.&nbsp;fits plot (stratified by treatment group). Let’s look at an example</p>
</section>
<section id="toy-example" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="toy-example">Toy Example</h2>
<p>Let’s generate some data to see how this works. We have a standard normal confounder, <img src="https://latex.codecogs.com/png.latex?X">:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb1-3">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb1-4">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n)</span></code></pre></div>
</div>
<p>The “true” propensity score, that is the probability that <img src="https://latex.codecogs.com/png.latex?T=1"> given <img src="https://latex.codecogs.com/png.latex?X"> is as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?e(x)%20=%20%5Cexp(x)%20/%20(1%20+%20%5Cexp(x))"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">e_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x))</span>
<span id="cb2-2">t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, e_x)</span></code></pre></div>
</div>
<p>The effect of the treatment, <img src="https://latex.codecogs.com/png.latex?T">, is <em>heterogeneous</em>, that is, it depends on <img src="https://latex.codecogs.com/png.latex?X">, as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AY(1)%20&amp;=%200.5%20%5Ctimes%20X%5C%5C%0AY(0)%20&amp;=%20-0.5%20%5Ctimes%20X%5C%5C%0AY_%7Bobs%7D%20&amp;=%20T%5Ctimes%20Y(1)%20+%20(1-T)%5Ctimes%20Y(0)%0A%5Cend%7Baligned%7D%0A"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">y1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n)</span>
<span id="cb3-2">y0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n)</span>
<span id="cb3-3">y_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> y1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> y0</span></code></pre></div>
</div>
<p>Ok, now we have our observed data, let’s put it all together:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb4-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y_obs,</span>
<span id="cb4-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> t,</span>
<span id="cb4-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x</span>
<span id="cb4-5">)</span></code></pre></div>
</div>
<section id="covariate-adjustment" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="covariate-adjustment">Covariate adjustment</h3>
<p>Let’s begin by estimating our causal effect by adjusting for <img src="https://latex.codecogs.com/png.latex?X"> directly in a model. Since <img src="https://latex.codecogs.com/png.latex?X"> is standard normal, this is actually going to be just fine.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>On when covariate adjustment will work, from Rosenbaum &amp; Rubin 1983: <em>Cases where covariance adjustment has been seen to perform quite poorly are precisely those cases in which the linear discriminant is not a monotone function of the propensity score, so that covariance adjustment is implicitly adjusting for a poor approximation to the propensity score. In the case of univariate <img src="https://latex.codecogs.com/png.latex?x">, the linear discriminant is a linear function of <img src="https://latex.codecogs.com/png.latex?x">, whereas the propensity score may not be a monotone function of <img src="https://latex.codecogs.com/png.latex?x"> if the variances of <img src="https://latex.codecogs.com/png.latex?x"> in the treated and control groups are unequal.</em></p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">model_noint <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x, data)</span>
<span id="cb5-2">model_noint</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ t + x, data = data)

Coefficients:
(Intercept)            t            x  
   0.226609    -0.003062    -0.012806  </code></pre>
</div>
</div>
<p>Looks like the treatment effect controlling for <img src="https://latex.codecogs.com/png.latex?X"> is ~0. Let’s look at some diagnostics, for example we can look at the residuals vs.&nbsp;fits plot.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>In an unfortunate oversight, in the paper I call this a <em>biased</em> estimate of the causal effect – it isn’t biased (it is the actual average treatment effect!) – It just isn’t terribly interesting as it doesn’t take the interaction into account.</p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitted</span>(model_noint), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(model_noint))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fitted"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-07-26-visual-diagnostic-tool-for-causal-inference/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ok, looks ok – maybe suggests a slightly non-linear relationship. Now let’s do what Rosenbaum &amp; Rubin suggest and examine this same plot stratified by treatment group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitted</span>(model_noint), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(model_noint), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(t))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fitted"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treatment"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-07-26-visual-diagnostic-tool-for-causal-inference/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Whoa! Look at that heterogeneity. Looks like that “average” treatment effect really only represents those in the middle of the distribution of the confounder, <img src="https://latex.codecogs.com/png.latex?X"> (which of course is exactly how we created the variable!).</p>
<p>We can fit the “correct” model, including the interaction and examine the plot again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">model_int <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x, data)</span>
<span id="cb9-2">model_int</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ t + x + t * x, data = data)

Coefficients:
(Intercept)            t            x          t:x  
    0.01437      0.02939     -0.48962      0.98383  </code></pre>
</div>
</div>
<p>Now let’s recreate the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitted</span>(model_int), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(model_int), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(t))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fitted"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Residuals"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treatment"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-07-26-visual-diagnostic-tool-for-causal-inference/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Beautiful!</p>
</section>
<section id="propensity-score" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="propensity-score">Propensity score</h3>
<p>Instead of using covariate adjustment, we could estimate our causal effect using propensity scores.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Note, here I am using logistic regression to fit the propensity score model, if I had used LDA instead and adjusted for that we would get the <em>exact</em> same answer as the previous section</p>
</div></div><p>Let’s begin by fitting a propensity score model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> binomial) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-3">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>)</span>
<span id="cb12-4">  ) </span></code></pre></div>
</div>
<p>We can examine the distribution of the propensity score. Let’s use the <code>halfmoon</code> package to create a mirrored histogram 😎</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Malcolm Barrett, Travis Gerke, and I have been working on a new suite of R packages for helping complete common causal inference tasks, check out our most recent posts here: https://r-causal.github.io/r-causal-blog/</p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(halfmoon)</span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(t))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_mirror_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>,</span>
<span id="cb13-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treatment"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-07-26-visual-diagnostic-tool-for-causal-inference/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Great! Looks good.</p>
<p>Now let’s estimate our average treatment effect. We can use the <code>propensity</code> package to calculate ATE weights:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wt_ate =</span> propensity<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wt_ate</span>(p, t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.treated =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb14-3">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weights =</span> wt_ate, data)</span>
<span id="cb14-4">model</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ t, data = data, weights = wt_ate)

Coefficients:
(Intercept)            t  
    0.05113     -0.02105  </code></pre>
</div>
</div>
<p>Great (although again we know this isn’t representative of most people in this population since we’ve induced some serious heterogeneity!). Now let’s create the plot suggested in the 1983 paper, examining the outcome vs the propensity score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(t))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">span =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"propensity score"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"treatment"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-07-26-visual-diagnostic-tool-for-causal-inference/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Whoa! Look at that effect heterogeneity! Looks like the only place where the average treatment effect (~0) is representative is when the propensity score is 0.5, when it is less, the effect is negative, and greater is it positive.</p>
<p>So there you have it! A simple plot to give a little more information than a single number summary (the average treatment effect). When estimating causal effects using covariate adjustment, a sensible and straightforward diagnostic plot to use is the residuals versus fits plot stratified by treatment assignment. If using a propensity score (as in this example) you can look at the outcome versus the propensity score. As mentioned in the paper, ideally these plots would be generated during the exploratory phase of the modeling process and once in the confirmatory phase the correct relationship between the treatment, confounders, and outcome would be well understood allowing the correct model to be pre-specified. Perhaps this can be added to the set of routine diagnostic tools used when assessing propensity score + outcome models in the future.</p>


</section>
</section>

 ]]></description>
  <category>rstats</category>
  <category>causal inference</category>
  <category>treatment heterogeneity</category>
  <guid>https://www.livefreeordichotomize.com/posts/2023-07-26-visual-diagnostic-tool-for-causal-inference/index.html</guid>
  <pubDate>Wed, 26 Jul 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Are two wrong models better than one? Missing data style</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2023-04-29-two-wrong-models-missing-data-style/index.html</link>
  <description><![CDATA[ 




<p>After my <a href="https://livefreeordichotomize.com/posts/2023-04-28-imputation-might-be-silly/">previous post about missing data</a>, Kathy <a href="https://twitter.com/CausalKathy/status/1652138888100470785?s=20">asked on Twitter</a> whether two wrong models (the imputation model + the outcome model) would be better than one (the outcome model alone).</p>
<blockquote class="blockquote">
<p>Without doing any of the math, I’d guess the assumption of correctly spec the model also has a bigger impact in the CC analysis.</p>
</blockquote>
<blockquote class="blockquote">
<p>You need correct spec in MI, twice, but trade off that potential bias for higher prec.</p>
</blockquote>
<p>This is a great question! I am going to investigate via a small simulation (so the answer could be “it depends”, but at least we will know how it seems to work in this very simple case) 😆.</p>
<p>Ok so here I have some predictor, <code>x</code> that is missing 50% of the time, dependent on <code>c_x</code> and <code>c_y</code>. The right imputation model would have <code>c_x</code>, the right outcome model needs <code>c_y</code>. Unfortunately, we only have access to one, which we will try to use in our imputation model (and outcome model). Let’s see whether two (wrong) models are better than one!</p>
<p>A “correct” model will be one that estimates that the coefficient for <code>x</code> is 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(broom)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mice)</span>
<span id="cb1-4"></span>
<span id="cb1-5">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">928</span>)</span>
<span id="cb1-8"></span>
<span id="cb1-9">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb1-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c_x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.71</span>),</span>
<span id="cb1-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> c_x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.71</span>),</span>
<span id="cb1-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c_y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb1-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb1-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">noise =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb1-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_miss =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(c_x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_y)))),</span>
<span id="cb1-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb1-17">    x_miss,</span>
<span id="cb1-18">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb1-19">    x</span>
<span id="cb1-20">  )</span>
<span id="cb1-21">)</span></code></pre></div>
</div>
<section id="we-only-have-c_x" class="level2">
<h2 class="anchored" data-anchor-id="we-only-have-c_x">We only have <code>c_x</code></h2>
<p>Ok first let’s look at the whole dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">mod_full_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb2-5"></span>
<span id="cb2-6">mod_full_c_x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  estimate conf.low conf.high
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1     1.01    0.877      1.14</code></pre>
</div>
</div>
<p>This checks out! <code>c_x</code> basically does nothing for us here, but because <code>c_y</code> is not actually a confounder (it just informs the missingness &amp; <code>y</code>, which we aren’t observing here), we are just fine estimating our “wrong” model in the fully observed data. Now let’s do the “complete cases” analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">data_cc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(data)</span>
<span id="cb4-2">mod_cc_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb4-6"></span>
<span id="cb4-7">mod_cc_c_x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  estimate conf.low conf.high
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1    0.999    0.812      1.19</code></pre>
</div>
</div>
<p>This does fine! Now let’s do some imputation. I am going to use the <code>mice</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">imp_data_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mice</span>(</span>
<span id="cb6-2">  data, </span>
<span id="cb6-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb6-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm.predict"</span>,</span>
<span id="cb6-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formulas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> c_x),</span>
<span id="cb6-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<p>Ok let’s compare how this model does “alone”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">mod_imp_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_data_c_x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb7-6"></span>
<span id="cb7-7">mod_imp_c_x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  estimate  conf.low conf.high
1 1.026666 0.9042858  1.149046</code></pre>
</div>
</div>
<p>Great! This was the right model, so we would expect this to perform well.</p>
<p>Now what happens if we adjust for <code>c_x</code> in addition in the outcome model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">mod_double_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_data_c_x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb9-6"></span>
<span id="cb9-7">mod_double_c_x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.9991868 0.7968509  1.201523</code></pre>
</div>
</div>
<p>The right imputation model with the wrong outcome model is fine!</p>
</section>
<section id="we-only-have-c_y" class="level2">
<h2 class="anchored" data-anchor-id="we-only-have-c_y">We only have <code>c_y</code></h2>
<p>Ok first let’s look at the whole dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">mod_full_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb11-5"></span>
<span id="cb11-6">mod_full_c_y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  estimate conf.low conf.high
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1     1.01    0.946      1.08</code></pre>
</div>
</div>
<p>Looks good! Now let’s do the “complete cases” analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">mod_cc_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb13-5"></span>
<span id="cb13-6">mod_cc_c_y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  estimate conf.low conf.high
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1     1.01    0.909      1.11</code></pre>
</div>
</div>
<p>Great! It works. This shows that as long as we have the right outcome model we can do complete case analysis even if the data is missing not at random (cool!). Now let’s do some imputation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">imp_data_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mice</span>(</span>
<span id="cb15-2">  data, </span>
<span id="cb15-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb15-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm.predict"</span>,</span>
<span id="cb15-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formulas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> c_y),</span>
<span id="cb15-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<p>Ok let’s compare how this model does “alone”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">mod_imp_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_data_c_y,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb16-6"></span>
<span id="cb16-7">mod_imp_c_y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate conf.low conf.high
1 0.6888255 0.527796  0.849855</code></pre>
</div>
</div>
<p>Oh no, very bad! The wrong imputation model is worse than complete case! By a lot! This estimate is off by 0.31. Does conditioning on <code>c_y</code> help us at all?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">mod_double_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_data_c_y, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb18-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb18-6"></span>
<span id="cb18-7">mod_double_c_y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  estimate  conf.low conf.high
1 1.009655 0.8887281  1.130582</code></pre>
</div>
</div>
<p>Phew, the wrong imputation model with the wrong outcome model is back to being fine.</p>
</section>
<section id="what-if-both-are-wrong" class="level2">
<h2 class="anchored" data-anchor-id="what-if-both-are-wrong">What if both are wrong?</h2>
<p>Ok, what if we just had our useless variable, <code>noise</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">mod_full_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> noise, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb20-5"></span>
<span id="cb20-6">mod_full_noise</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  estimate conf.low conf.high
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1    0.992    0.898      1.09</code></pre>
</div>
</div>
<p>This is fine! <code>c_x</code> and <code>c_y</code> aren’t confoudners so we can estimate the coefficent for <code>x</code> without them – <code>noise</code> doesn’t do anything, but it also doesn’t hurt. What about complete case?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">mod_cc_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> noise, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb22-5"></span>
<span id="cb22-6">mod_cc_noise</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  estimate conf.low conf.high
     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1    0.887    0.748      1.03</code></pre>
</div>
</div>
<p>Oops! We’ve got bias (as expected!) – we end up with a biased estimate by ~0.11.</p>
<p>What if we build the (wrong) imputation model?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">imp_data_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mice</span>(</span>
<span id="cb24-2">  data, </span>
<span id="cb24-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb24-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm.predict"</span>,</span>
<span id="cb24-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formulas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> noise),</span>
<span id="cb24-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) </span></code></pre></div>
</div>
<p>Ok let’s compare how this model does “alone”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">mod_imp_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_data_noise, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb25-6"></span>
<span id="cb25-7">mod_imp_noise</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.8807755 0.7217368  1.039814</code></pre>
</div>
</div>
<p>This is also wrong (womp womp!) What if we try two wrong models?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">mod_double_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_data_noise,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> noise)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb27-6"></span>
<span id="cb27-7">mod_double_noise</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.8865363 0.7275635  1.045509</code></pre>
</div>
</div>
<p>Nope 😢. Two wrong models here are not better than one! It’s worse! Womp womp.</p>
<p>Let’s put these all together:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb29-2">  mod_full_c_x,</span>
<span id="cb29-3">  mod_full_c_y,</span>
<span id="cb29-4">  mod_full_noise,</span>
<span id="cb29-5">  mod_cc_c_x,</span>
<span id="cb29-6">  mod_cc_c_y,</span>
<span id="cb29-7">  mod_cc_noise,</span>
<span id="cb29-8">  mod_imp_c_x,</span>
<span id="cb29-9">  mod_imp_c_y,</span>
<span id="cb29-10">  mod_imp_noise,</span>
<span id="cb29-11">  mod_double_c_x,</span>
<span id="cb29-12">  mod_double_c_y,</span>
<span id="cb29-13">  mod_double_noise</span>
<span id="cb29-14">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb29-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mod =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_x"</span>, </span>
<span id="cb29-17">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_y"</span>, </span>
<span id="cb29-18">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with noise"</span>,</span>
<span id="cb29-19">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with c_x"</span>,</span>
<span id="cb29-20">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case wtih c_y"</span>,</span>
<span id="cb29-21">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with noise"</span>,</span>
<span id="cb29-22">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with c_x"</span>,</span>
<span id="cb29-23">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with c_y"</span>,</span>
<span id="cb29-24">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with noise"</span>,</span>
<span id="cb29-25">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_x"</span>,</span>
<span id="cb29-26">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_y"</span>,</span>
<span id="cb29-27">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with noise"</span> ),</span>
<span id="cb29-28">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_x"</span>, </span>
<span id="cb29-29">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with c_x"</span>,</span>
<span id="cb29-30">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with c_x"</span>,</span>
<span id="cb29-31">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_x"</span>,</span>
<span id="cb29-32">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_y"</span>, </span>
<span id="cb29-33">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case wtih c_y"</span>,</span>
<span id="cb29-34">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with c_y"</span>,</span>
<span id="cb29-35">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_y"</span>,</span>
<span id="cb29-36">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with noise"</span>,</span>
<span id="cb29-37">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with noise"</span>,</span>
<span id="cb29-38">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with noise"</span>,</span>
<span id="cb29-39">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with noise"</span> )),</span>
<span id="cb29-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mod =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(mod),</span>
<span id="cb29-41">  ) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> to_plot</span>
<span id="cb29-42"></span>
<span id="cb29-43"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(to_plot, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> estimate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin =</span> conf.low, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax =</span> conf.high, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mod)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_pointrange</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb29-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-04-29-two-wrong-models-missing-data-style/index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So there you have it, two wrong models are rarely better than one.</p>
</section>
<section id="addendum" class="level2">
<h2 class="anchored" data-anchor-id="addendum">Addendum!</h2>
<p>In writing this post, I found that I was getting biased results when I was correctly specifying my imputation model when using the <code>{mice}</code> defaults (which is why the code above specifies <code>norm.predict</code> for the method, forcing it to use linear regression, as the data were generated). I didn’t understand why this is happening until some helpful friends on Twitter explained it (thank you <a href="https://twitter.com/rrandridge">Rebecca</a>, <a href="https://twitter.com/DrJWolfson">Julian</a>, and <a href="https://twitter.com/mariokeko1995/">Mario</a>. I’ll show you what is happening and then I’ll show a quick explanation. Let’s try to redo the imputation models using the defaults:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">imp_default_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mice</span>(</span>
<span id="cb30-2">  data, </span>
<span id="cb30-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb30-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formulas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> c_x),</span>
<span id="cb30-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">mod_imp_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_default_c_x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb31-6"></span>
<span id="cb31-7">mod_imp_c_x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.7353276 0.6194273 0.8512279</code></pre>
</div>
</div>
<p>Bad!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">mod_double_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_default_c_x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb33-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb33-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb33-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb33-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb33-6"></span>
<span id="cb33-7">mod_double_c_x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate conf.low conf.high
1 0.4602637  0.30023 0.6202974</code></pre>
</div>
</div>
<p>Even worse!!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">imp_default_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mice</span>(</span>
<span id="cb35-2">  data, </span>
<span id="cb35-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb35-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formulas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> c_y),</span>
<span id="cb35-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">mod_imp_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_default_c_y, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb36-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb36-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb36-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb36-6"></span>
<span id="cb36-7">mod_imp_c_y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.3405789 0.1126282 0.5685295</code></pre>
</div>
</div>
<p>YIKES!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">mod_double_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_default_c_y, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb38-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb38-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb38-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb38-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb38-6"></span>
<span id="cb38-7">mod_double_c_y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.5128878 0.3216547 0.7041208</code></pre>
</div>
</div>
<p>Better since we are conditioning on <code>c_y</code> (but still bad!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">imp_default_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mice</span>(</span>
<span id="cb40-2">  data, </span>
<span id="cb40-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb40-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formulas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> noise),</span>
<span id="cb40-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) </span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">mod_imp_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_default_noise, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb41-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb41-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb41-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb41-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb41-6"></span>
<span id="cb41-7">mod_imp_noise</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.4076967 0.2352155 0.5801779</code></pre>
</div>
</div>
<p>EEK!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1">mod_double_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_default_noise,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> noise)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb43-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb43-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb43-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb43-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb43-6"></span>
<span id="cb43-7">mod_double_noise</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.4124791 0.2497624 0.5751959</code></pre>
</div>
</div>
<p>Just as bad..</p>
<p>Let’s put those in the original plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb45-2">  mod_full_c_x,</span>
<span id="cb45-3">  mod_full_c_y,</span>
<span id="cb45-4">  mod_full_noise,</span>
<span id="cb45-5">  mod_cc_c_x,</span>
<span id="cb45-6">  mod_cc_c_y,</span>
<span id="cb45-7">  mod_cc_noise,</span>
<span id="cb45-8">  mod_imp_c_x,</span>
<span id="cb45-9">  mod_imp_c_y,</span>
<span id="cb45-10">  mod_imp_noise,</span>
<span id="cb45-11">  mod_double_c_x,</span>
<span id="cb45-12">  mod_double_c_y,</span>
<span id="cb45-13">  mod_double_noise</span>
<span id="cb45-14">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb45-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb45-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mod =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_x"</span>, </span>
<span id="cb45-17">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_y"</span>, </span>
<span id="cb45-18">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with noise"</span>,</span>
<span id="cb45-19">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with c_x"</span>,</span>
<span id="cb45-20">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case wtih c_y"</span>,</span>
<span id="cb45-21">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with noise"</span>,</span>
<span id="cb45-22">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default Imputation with c_x"</span>,</span>
<span id="cb45-23">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default Imputation with c_y"</span>,</span>
<span id="cb45-24">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default Imputation with noise"</span>,</span>
<span id="cb45-25">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_x"</span>,</span>
<span id="cb45-26">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_y"</span>,</span>
<span id="cb45-27">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with noise"</span> ),</span>
<span id="cb45-28">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_x"</span>, </span>
<span id="cb45-29">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with c_x"</span>,</span>
<span id="cb45-30">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default Imputation with c_x"</span>,</span>
<span id="cb45-31">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_x"</span>,</span>
<span id="cb45-32">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_y"</span>, </span>
<span id="cb45-33">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case wtih c_y"</span>,</span>
<span id="cb45-34">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default Imputation with c_y"</span>,</span>
<span id="cb45-35">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_y"</span>,</span>
<span id="cb45-36">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with noise"</span>,</span>
<span id="cb45-37">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with noise"</span>,</span>
<span id="cb45-38">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default Imputation with noise"</span>,</span>
<span id="cb45-39">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with noise"</span> )),</span>
<span id="cb45-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mod =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(mod),</span>
<span id="cb45-41">  ) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> to_plot</span>
<span id="cb45-42"></span>
<span id="cb45-43"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(to_plot, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> estimate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin =</span> conf.low, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax =</span> conf.high, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mod)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb45-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_pointrange</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb45-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-04-29-two-wrong-models-missing-data-style/index_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>AHH! This makes me so scared of imputation!!</p>
<p><a href="https://twitter.com/rrandridge/status/1653029200838664193?s=20">Rebecca Andridge’s tweet</a> finally helped me see why this is happening. The way the missing data is generated, larger values of <code>c_x</code> have a higher probability of missingness, and for particularly high values of <code>c_x</code> that probability is almost 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(x_miss))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb46-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.31</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb46-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"missing"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-04-29-two-wrong-models-missing-data-style/index_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Take a look at the plot above. We have <em>no</em> non-missing <code>x</code> values that are greater than 2.3. The way predictive mean matching (the default <code>{mice}</code> method) works is it finds the observation(s) that have the closest predicted value to the observation that is missing a data point and gives you <em>that</em> non-missing data point’s value. So here, we are essentially truncating our distribution at 2.3, since that is the highest value observed. Any value that would have been higher is going to be necessarily too small instead of the right value (this is different from the linear model method used in the first part of this post, which allows you to extrapolate). This is supposed to be a less biased approach, since it doesn’t allow you to extrapolate beyond the bounds of your observed data, but it can actually induce bias when you have pockets of missingness with no observed <code>x</code>s (which I would argue might happen frequently!). Here is an example of one of the imputed datasets, notice nothing is above that 2.3 line!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete</span>(imp_default_c_x), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x_obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(x_miss))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb47-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb47-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.31</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"imputed"</span>) </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-04-29-two-wrong-models-missing-data-style/index_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="what-if-we-use-y-in-the-imputation-models" class="level2">
<h2 class="anchored" data-anchor-id="what-if-we-use-y-in-the-imputation-models">What if we use <code>y</code> in the imputation models</h2>
<p>Including <code>y</code> in the imputation model <a href="https://pubmed.ncbi.nlm.nih.gov/16980150/">is definitely recommended</a>, as was hammered home for me by the wonderful Frank Harrell, but I’m not sure this recommendation has permeated through the field yet (although <a href="https://journals.sagepub.com/doi/10.1177/09622802231165001">this paper re-iterating this result</a> just came out yesterday so maybe it is!).</p>
<p>Let’s see how that improves our imputation models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1">imp_y_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mice</span>(</span>
<span id="cb48-2">  data, </span>
<span id="cb48-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb48-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formulas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> c_x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y),</span>
<span id="cb48-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1">mod_imp_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_y_c_x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb49-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb49-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb49-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb49-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb49-6"></span>
<span id="cb49-7">mod_imp_c_x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  estimate  conf.low conf.high
1 1.034138 0.9109341  1.157343</code></pre>
</div>
</div>
<p>Beautiful!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1">mod_double_c_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_y_c_x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb51-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb51-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb51-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb51-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb51-6"></span>
<span id="cb51-7">mod_double_c_x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  estimate  conf.low conf.high
1  1.08074 0.8772936  1.284186</code></pre>
</div>
</div>
<p>A bit worse, but not bad!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1">imp_y_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mice</span>(</span>
<span id="cb53-2">  data, </span>
<span id="cb53-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb53-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formulas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> c_y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y),</span>
<span id="cb53-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1">mod_imp_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_y_c_y, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb54-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb54-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb54-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb54-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb54-6"></span>
<span id="cb54-7">mod_imp_c_y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.9298631 0.8137157  1.046011</code></pre>
</div>
</div>
<p>Not bad!! A bit biased but way better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1">mod_double_c_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_y_c_y, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c_y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb56-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb56-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb56-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb56-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb56-6"></span>
<span id="cb56-7">mod_double_c_y</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  estimate  conf.low conf.high
1  1.01812 0.9415964  1.094644</code></pre>
</div>
</div>
<p>Love it, looks great after conditioning on <code>c_y</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1">imp_y_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mice</span>(</span>
<span id="cb58-2">  data, </span>
<span id="cb58-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb58-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formulas =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> noise <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y),</span>
<span id="cb58-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) </span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1">mod_imp_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_y_noise, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb59-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb59-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb59-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb59-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb59-6"></span>
<span id="cb59-7">mod_imp_noise</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.9671593 0.8580147  1.076304</code></pre>
</div>
</div>
<p>Oo lala, even does well when we don’t have the right model (this makes sense because we are using <code>y</code>!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1">mod_double_noise <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(imp_y_noise, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> noise)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb61-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pool</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb61-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb61-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(term <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x_obs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb61-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb61-6"></span>
<span id="cb61-7">mod_double_noise</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   estimate  conf.low conf.high
1 0.9697639 0.8612499  1.078278</code></pre>
</div>
</div>
<p>Let’s put those in the original plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb63-2">  mod_full_c_x,</span>
<span id="cb63-3">  mod_full_c_y,</span>
<span id="cb63-4">  mod_full_noise,</span>
<span id="cb63-5">  mod_cc_c_x,</span>
<span id="cb63-6">  mod_cc_c_y,</span>
<span id="cb63-7">  mod_cc_noise,</span>
<span id="cb63-8">  mod_imp_c_x,</span>
<span id="cb63-9">  mod_imp_c_y,</span>
<span id="cb63-10">  mod_imp_noise,</span>
<span id="cb63-11">  mod_double_c_x,</span>
<span id="cb63-12">  mod_double_c_y,</span>
<span id="cb63-13">  mod_double_noise</span>
<span id="cb63-14">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb63-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb63-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mod =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_x"</span>, </span>
<span id="cb63-17">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_y"</span>, </span>
<span id="cb63-18">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with noise"</span>,</span>
<span id="cb63-19">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with c_x"</span>,</span>
<span id="cb63-20">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case wtih c_y"</span>,</span>
<span id="cb63-21">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with noise"</span>,</span>
<span id="cb63-22">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with c_x and y"</span>,</span>
<span id="cb63-23">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with c_y and y"</span>,</span>
<span id="cb63-24">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with noise and y"</span>,</span>
<span id="cb63-25">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_x"</span>,</span>
<span id="cb63-26">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_y"</span>,</span>
<span id="cb63-27">                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with noise"</span> ),</span>
<span id="cb63-28">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_x"</span>, </span>
<span id="cb63-29">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with c_x"</span>,</span>
<span id="cb63-30">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with c_x and y"</span>,</span>
<span id="cb63-31">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_x"</span>,</span>
<span id="cb63-32">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with c_y"</span>, </span>
<span id="cb63-33">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case wtih c_y"</span>,</span>
<span id="cb63-34">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with c_y and y"</span>,</span>
<span id="cb63-35">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with c_y"</span>,</span>
<span id="cb63-36">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full data with noise"</span>,</span>
<span id="cb63-37">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Complete case with noise"</span>,</span>
<span id="cb63-38">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Imputation with noise and y"</span>,</span>
<span id="cb63-39">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Two models with noise"</span> )),</span>
<span id="cb63-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mod =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(mod),</span>
<span id="cb63-41">  ) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-&gt;</span> to_plot</span>
<span id="cb63-42"></span>
<span id="cb63-43"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(to_plot, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> estimate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin =</span> conf.low, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax =</span> conf.high, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> mod)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb63-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_pointrange</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb63-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-04-29-two-wrong-models-missing-data-style/index_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Pretty good! Maybe I’m feeling a little better about imputation. Maybe. But it had better include the outcome (which I’ll admit feels <em>very</em> weird for my little causal brain).</p>


</section>

 ]]></description>
  <category>rstats</category>
  <category>simulations</category>
  <category>missing data</category>
  <guid>https://www.livefreeordichotomize.com/posts/2023-04-29-two-wrong-models-missing-data-style/index.html</guid>
  <pubDate>Sat, 29 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>When is complete case analysis unbiased?</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2023-04-28-imputation-might-be-silly/index.html</link>
  <description><![CDATA[ 




<p>Here is the scenario: You are trying to predict some outcome, <img src="https://latex.codecogs.com/png.latex?y">, and some of your predictors have missing data. Will doing a complete case analysis give you unbiased results? What additional information do you need before deciding?</p>
<p>For some reason, when I tried to answer this question, my first instinct was to try to decide whether the data were <em>missing at random</em>, but it turns out, this might not be the right first question! Why? Complete case analysis will give us unbiased estimates <strong>even if the data are not missing at random</strong>. Excuse me? Yes. When is this the case? When:</p>
<ol type="1">
<li>The missingness is not dependent on the outcome (this one seems like it <em>should</em> hold if we are using proper predictors, since in order to predict y they should precede y, making the value of y unable to determine their missingness, (I think!)).</li>
<li>You have correctly specified your model</li>
<li>Your outcome doesn’t have any missing data (this is more extreme than the actual assumption needed, but if there is no missing outcome data then you should definitely be ok, see below for the nuance)</li>
</ol>
<p>When I was thinking through this, I found it helped to work up a few short simulations, so here we go.</p>
<section id="scenario-1-i-have-a-predictor-that-is-missing-not-at-random" class="level2">
<h2 class="anchored" data-anchor-id="scenario-1-i-have-a-predictor-that-is-missing-not-at-random">Scenario 1: I have a predictor that is missing not at random</h2>
<p>First let’s generate our “true” values. Here the true model is below, which shows that:</p>
<p><img src="https://latex.codecogs.com/png.latex?y%20=%20x%20+%20%5Cvarepsilon"></p>
<p>In other words, <img src="https://latex.codecogs.com/png.latex?%5Cbeta_0:%200"> and <img src="https://latex.codecogs.com/png.latex?%5Cbeta_1:%201"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"></span>
<span id="cb1-3">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-6">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb1-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb1-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb1-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n)</span>
<span id="cb1-10">)</span></code></pre></div>
</div>
<p>Let’s force <code>x</code> to be missing under three scenarios:</p>
<ul>
<li>Missing completely at random</li>
<li>Missing conditionally at random (based on <code>c</code>)</li>
<li>Missing not at random</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs_mcar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb2-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), </span>
<span id="cb2-5">      <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, </span>
<span id="cb2-6">      x</span>
<span id="cb2-7">    ),</span>
<span id="cb2-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs_mar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb2-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>c))),</span>
<span id="cb2-10">      <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb2-11">      x</span>
<span id="cb2-12">    ),</span>
<span id="cb2-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs_mnar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb2-14">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x))),</span>
<span id="cb2-15">      <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb2-16">      x</span>
<span id="cb2-17">    )</span>
<span id="cb2-18">  )</span>
<span id="cb2-19"></span>
<span id="cb2-20">data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mcar_miss =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(x_obs_mcar)),</span>
<span id="cb2-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mar_miss =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(x_obs_mar)),</span>
<span id="cb2-23">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mnar_miss =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(x_obs_mnar)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  mcar_miss mar_miss mnar_miss
      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1     0.501    0.500     0.501</code></pre>
</div>
</div>
<p>In all three cases ~50% of the data are missing.</p>
<p>Let’s see how these impact the ability to predict <code>y</code> (and the estimation of <img src="https://latex.codecogs.com/png.latex?%5Chat%5Cbeta">)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs_mcar, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x_obs_mcar, data = data)

Coefficients:
(Intercept)   x_obs_mcar  
   -0.00104      0.99964  </code></pre>
</div>
</div>
<p>Ok, the missing completely at random <code>x</code> is estimated correctly when we do a complete cases analysis (that is when we list-wise delete every row that has missing data). This checks out!</p>
<p>Let’s check out the missing conditionally at random <code>x</code>. Note that this is missing at random after conditioning on <code>c</code> (although we aren’t actually doing anything with <code>c</code> at this point, so it might as well be missing not at random…)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs_mar, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x_obs_mar, data = data)

Coefficients:
(Intercept)    x_obs_mar  
  -0.000482     0.999835  </code></pre>
</div>
</div>
<p>Whoa! Prediction is still correct and the coefficients themselves are still unbiased even if we do complete case analysis.</p>
<p>Ok, what about missing not at random?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_obs_mnar, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x_obs_mnar, data = data)

Coefficients:
(Intercept)   x_obs_mnar  
  -7.23e-05     9.99e-01  </code></pre>
</div>
</div>
<p>Still ok! No bias in the coefficients and the predicted values are unbiased even though the predictor was missing <strong>not</strong> at random (and we did a complete cases analysis).</p>
<p>Why is this the case? Travis Gerke pointed out <a href="https://researchonline.lshtm.ac.uk/id/eprint/1198/1/research_online_1198.pdf">this excellent paper</a> that has a beautiful plot that demonstrates why this happens. I am going to simulate some smaller data than what I have above to demonstrate the point. Here, the missingess is deterministic (and definitely not random!) – if <code>x</code> is greater than 0, it is missing, otherwise it isn’t. Again, this renders ~50% of our data missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb10-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb10-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>),</span>
<span id="cb10-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_miss =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"no"</span>)</span>
<span id="cb10-5">)</span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> x_miss)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflowerblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"observed data"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflowerblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"missing data"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-04-28-imputation-might-be-silly/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Maybe this result is a somewhat obvious result because despite the fact that the missingness was not at random, it had nothing to do with the outcome, <code>y</code>, let’s see what would happen if <code>c</code> was related to <code>y</code>.</p>
</section>
<section id="scenario-2-i-have-missing-data-that-is-missing-due-to-some-factor-and-other-things-so-still-not-mar" class="level2">
<h2 class="anchored" data-anchor-id="scenario-2-i-have-missing-data-that-is-missing-due-to-some-factor-and-other-things-so-still-not-mar">Scenario 2: I have missing data that is missing due to some factor (and other things, so still not MAR)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-2">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb11-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb11-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb11-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n)</span>
<span id="cb11-6">)</span></code></pre></div>
</div>
<p>Let’s say we have some data that is not missing at random. The probability that <code>x</code> is missing is dependent both on it’s own value (MNAR!) and the value of <code>c</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs =</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb12-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c)))),</span>
<span id="cb12-4">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb12-5">    x</span>
<span id="cb12-6">  )</span>
<span id="cb12-7">  )</span></code></pre></div>
</div>
<p>This results in missing ~ 50% of the values for <code>x</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">miss_x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(x_obs))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  miss_x      n
  &lt;lgl&gt;   &lt;int&gt;
1 FALSE  499277
2 TRUE   500723</code></pre>
</div>
</div>
<p>So what happens if we try to predict <code>y</code>? Let’s try it first with the full data as a benchmark:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">right_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">right_mod</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + c, data = data)

Coefficients:
(Intercept)            x            c  
  -0.000162     1.000106     0.999592  </code></pre>
</div>
</div>
<p>Beautiful. we get the correct <img src="https://latex.codecogs.com/png.latex?%5Chat%5Cbeta"> estimates (and thus the correct predictions for <code>y</code>).</p>
<p>Now let’s take a look at the complete case analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">data_cc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(data)</span>
<span id="cb18-2"></span>
<span id="cb18-3">cc_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">cc_mod</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + c, data = data_cc)

Coefficients:
(Intercept)            x            c  
    0.00128      1.00032      1.00156  </code></pre>
</div>
</div>
<p>Would you look at that. Correct coefficients! How could we break that? If we misspecified the model, for example if we didn’t adjust for <code>c</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = data_cc)

Coefficients:
(Intercept)            x  
     -0.419        0.849  </code></pre>
</div>
</div>
<p>But is this a terribly interesting case? If we don’t have a way to predict the missing <code>x</code> values (MNAR!) we couldn’t impute it anyways, so we would be in trouble imputation or not!</p>
</section>
<section id="scenario-3-what-about-inference" class="level2">
<h2 class="anchored" data-anchor-id="scenario-3-what-about-inference">Scenario 3: What about inference?</h2>
<p>This is the same as above, but I found it helpful to frame as an inference question. What if I have some treatment, <code>x</code> that is randomly assigned, but is missing based on some factor <code>c</code> that is related to my outcome of interest, <code>y</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb23-2">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb23-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># randomly assigned exposure</span></span>
<span id="cb23-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># problem variable</span></span>
<span id="cb23-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true treatment effect is 1</span></span>
<span id="cb23-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c)))),</span>
<span id="cb23-7">                 <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, x) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># missing based on x and c</span></span>
<span id="cb23-8">)</span></code></pre></div>
</div>
<p>First of all, in the absense of any missing data we don’t actually need to adjust for c in order to get an unbiased estimate for <code>x</code> because <code>c</code> is not a confounder (yay!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = data)

Coefficients:
(Intercept)            x  
   0.000368     0.998409  </code></pre>
</div>
</div>
<p>BUT! With missing data, we <em>do</em> have a problem:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">data_cc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(data)</span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = data_cc)

Coefficients:
(Intercept)            x  
     -0.413        0.825  </code></pre>
</div>
</div>
<p>Oops! Now we are seeing an effect of 0.825 when the true effect of the exposure is 1 (because we did a bad thing and just deleted all the missing rows). In the past, this is where I would say <em>and therefore you should do imputation!</em> BUT instead, just adjust for <code>c</code>, that is correctly specify your outcome model and all will be well:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + c, data = data_cc)

Coefficients:
(Intercept)            x            c  
   -0.00149      1.00241      1.00161  </code></pre>
</div>
</div>
<section id="what-if-there-is-treatment-heterogeneity" class="level3">
<h3 class="anchored" data-anchor-id="what-if-there-is-treatment-heterogeneity">What if there is treatment heterogeneity?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb30-2">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb30-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># randomly assigned exposure</span></span>
<span id="cb30-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># problem variable</span></span>
<span id="cb30-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true treatment effect varies by c</span></span>
<span id="cb30-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c)))),</span>
<span id="cb30-7">                 <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, x) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># missing based on x and c</span></span>
<span id="cb30-8">)</span></code></pre></div>
</div>
<p>Complete case analysis is fine as long as the model for the outcome is correctly specified:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">data_cc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(data)</span>
<span id="cb31-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>c, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + c + x * c, data = data_cc)

Coefficients:
(Intercept)            x            c          x:c  
   -0.00122      1.00149      1.00228      0.99824  </code></pre>
</div>
</div>
</section>
<section id="does-the-outcome-model-have-to-be-perfectly-specified" class="level3">
<h3 class="anchored" data-anchor-id="does-the-outcome-model-have-to-be-perfectly-specified">Does the outcome model have to be perfectly specified?</h3>
<p>Here I have an additional factor <code>c2</code> that just influences <code>y</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb33-2">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb33-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># randomly assigned exposure</span></span>
<span id="cb33-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># problem variable</span></span>
<span id="cb33-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># some other thing that only influences y</span></span>
<span id="cb33-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># true treatment effect varies by c</span></span>
<span id="cb33-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c)))),</span>
<span id="cb33-8">                 <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, x) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># missing based on x and c</span></span>
<span id="cb33-9">)</span></code></pre></div>
</div>
<p>Complete case analysis is fine as long as the model for the outcome has the things that influence both the exposure and outcome (confounders) and the things that influence the missing data mechanism and outcome (in this case just <code>c</code>) if all we care about is the effect of <code>x</code> on <code>y</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">data_cc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(data)</span>
<span id="cb34-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + c, data = data_cc)

Coefficients:
(Intercept)            x            c  
  -0.000207     1.000115     0.999957  </code></pre>
</div>
</div>
</section>
</section>
<section id="scenario-4-what-if-the-outcome-has-some-missing-data" class="level2">
<h2 class="anchored" data-anchor-id="scenario-4-what-if-the-outcome-has-some-missing-data">Scenario 4: What if the outcome has some missing data?</h2>
<p>Ok this is where things are a bit trickier (and it is not uncommon to find yourself here, for example loss to follow-up!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb36-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb36-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb36-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb36-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb36-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c)))), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x is missing not at random (based on value of x and c)</span></span>
<span id="cb36-7">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb36-8">    x</span>
<span id="cb36-9">  ),</span>
<span id="cb36-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb36-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c)))), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># y is missing (conditionally) at random</span></span>
<span id="cb36-12">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, </span>
<span id="cb36-13">    y</span>
<span id="cb36-14">  )</span>
<span id="cb36-15">)</span></code></pre></div>
</div>
<p>Based on both of these missingness patterns, we are down to ~66% of our data having at least one missing value. AND YET we get unbiased results when we do complete case analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">data_cc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(data)</span>
<span id="cb37-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c, data_cc)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + c, data = data_cc)

Coefficients:
(Intercept)            x            c  
    0.00441      1.00213      1.00114  </code></pre>
</div>
</div>
<p>SO when is it a problem? If you are missing <code>y</code> and <code>y</code> is missing <strong>not at random</strong> then you are in trouble (<em>but, I will note that you would also be in trouble in this case if you wanted to do imputation, so I’m not sure this is really a case for anything other than yet another example of a case where statistics cannot save you from everything!</em>). Let’s look at that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb39-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb39-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb39-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n),</span>
<span id="cb39-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb39-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c)))), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x is missing not at random (based on value of x and c)</span></span>
<span id="cb39-7">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb39-8">    x</span>
<span id="cb39-9">  ),</span>
<span id="cb39-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y_obs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb39-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y)))), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># y is missing not at random</span></span>
<span id="cb39-12">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, </span>
<span id="cb39-13">    y</span>
<span id="cb39-14">  )</span>
<span id="cb39-15">)</span></code></pre></div>
</div>
<p>Womp womp, here we have a problem, when we do complete case analysis, even with the correctly specified model, we get the wrong answer:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">data_cc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(data)</span>
<span id="cb40-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> c, data_cc)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + c, data = data_cc)

Coefficients:
(Intercept)            x            c  
     -0.352        0.849        0.848  </code></pre>
</div>
</div>
<p>Let’s make another of those cool graphs like they did in that awesome paper explaining missing data in terms of causal inference. Now I am going to make <code>y</code> missing not at random, as opposed to <code>x</code> like above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb42-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb42-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>),</span>
<span id="cb42-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y_miss =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"no"</span>)</span>
<span id="cb42-5">)</span>
<span id="cb42-6"></span>
<span id="cb42-7">data_cc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data[data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y_miss <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"no"</span>, ]</span>
<span id="cb42-8"></span>
<span id="cb42-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(geomtextpath)</span>
<span id="cb42-10"></span>
<span id="cb42-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> y_miss)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb42-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_textline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb42-14">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data))), </span>
<span id="cb42-15">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"truth"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_textline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc, </span>
<span id="cb42-17">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_cc))), </span>
<span id="cb42-18">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wrong"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb42-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb42-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflowerblue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"missing data"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb42-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"observed data"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflowerblue"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb42-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb42-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2023-04-28-imputation-might-be-silly/index_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="standard-errors" class="level2">
<h2 class="anchored" data-anchor-id="standard-errors">Standard errors</h2>
<p>This post is about <strong>bias</strong> but I would be remiss not to mention the sacrifice in precision that complete case analyses make. It is true that complete case analysis is “throwing away” data, so the standard errors of these estimates will be larger than they would be had we observed the full data set. BUT these standard errors are out of the box “correct” (which is not true if you do something like single imputation, for example!)</p>


</section>

 ]]></description>
  <category>rstats</category>
  <category>simulations</category>
  <category>missing data</category>
  <guid>https://www.livefreeordichotomize.com/posts/2023-04-28-imputation-might-be-silly/index.html</guid>
  <pubDate>Fri, 28 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>It’s just a linear model: neural networks edition</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2023-04-27-its-just-a-linear-model-neural-nets/index.html</link>
  <description><![CDATA[ 




<p>I created a little Shiny application to demonstrate that Neural Networks are just souped up linear models: https://lucy.shinyapps.io/neural-net-linear/</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2023-04-27/app.gif" class="img-fluid"></p>
<p>This application has a neural network fit to a dataset with one predictor, x, and one outcome, y. The network has one hidden layer with three activations. You can click a “Play” button to watch how the neural network fits across 300 epochs. You can also click on the nodes of the neural network diagram to highlight each of the individual activations across the applciation (along with their corresponding coefficients).</p>



 ]]></description>
  <category>statistical communication</category>
  <category>data science pedoagogy</category>
  <category>neural-networks</category>
  <guid>https://www.livefreeordichotomize.com/posts/2023-04-27-its-just-a-linear-model-neural-nets/index.html</guid>
  <pubDate>Thu, 27 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Causal Quartets</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2023-04-24-causal-quartets/index.html</link>
  <description><![CDATA[ 




<p>On this weeks episode of <a href="https://casualinfer.libsyn.com">Casual Inference</a> we talk about a “Causal Quartet” a set of four datasets generated under different mechanisms, all with the same statistical summaries (including visualizations!) but different true causal effects.</p>
<p><em>The figures and tables are from our recent preprint: https://arxiv.org/pdf/2304.02683.pdf</em> <img src="https://www.livefreeordichotomize.com/media/images/2023-04-24/plot1.jpeg" class="img-fluid"></p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2023-04-24/plot2.jpeg" class="img-fluid"></p>
<p>Given a single dataset with 3 variables: exposure, outcome and covariate (z) how can statistics help you decide whether to adjust for z? It can’t! For example here, the correlation between z and the exposure in all 4 datasets is 0.7!</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2023-04-24/tab1.jpeg" class="img-fluid"> <img src="https://www.livefreeordichotomize.com/media/images/2023-04-24/tab2.jpeg" class="img-fluid"> So if Stats can’t help what can we do? Well the best thing is just to know the data generating mechanism but that is hard! An easier solution is to make sure to have time varying measurements and only adjust for pre-exposure covariates! This solves the problem in 3/4 of the sets!</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2023-04-24/plot3.jpeg" class="img-fluid"></p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2023-04-24/tab3.jpeg" class="img-fluid"></p>
<p>The one it doesn’t solve is M-bias, but as our podcast episode title suggests (<a href="https://casualinfer.libsyn.com/m-bias-much-ado-about-nothing-season-4-episode-10">M-Bias: Much Ado About Nothing?</a>) this may be much ado about nothing (give a listen to find out why!) Also…credit to ChatGPT for our episode title 😂</p>
<p>Malcolm Barrett, Travis Gerke, and I have a preprint with details: https://arxiv.org/pdf/2304.02683.pdf</p>
<p>Also the <a href="https://r-causal.github.io/quartets/"><code>quartets</code></a> package includes the datasets if you’d like to play with it yourselves!</p>
<p><em>I also learned last month about another awesome “causal quartet” by Gelman, Jessica Hullman, and Lauren Kennedy that focuses on treatment heterogeneity so I could use help coming up with a new name for ours!</em></p>



 ]]></description>
  <category>causal inference</category>
  <category>statistical communication</category>
  <category>data science pedoagogy</category>
  <category>confounding</category>
  <guid>https://www.livefreeordichotomize.com/posts/2023-04-24-causal-quartets/index.html</guid>
  <pubDate>Mon, 24 Apr 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.livefreeordichotomize.com/posts/2023-04-24-causal-quartets/featured.jpeg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Transparency in Public Health</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2022-12-14-transparency-in-public-health/index.html</link>
  <description><![CDATA[ 




<p>Transparency in public health messaging matters. <a href="https://twitter.com/hanmmendoza">Hannah Mendoza</a> and I looked at how providing transparent information about why a public health recommendation is being made can increase uptake in a randomized trial published today in <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0278263">Plos One</a></p>
<section id="what-did-we-do" class="level2">
<h2 class="anchored" data-anchor-id="what-did-we-do">What did we do?</h2>
<p>We conducted a randomized controlled trial to assess whether disclosing elements of uncertainty in an initial public health statement will change the likelihood that participants will accept new, different advice that arises as more evidence is uncovered.</p>
<p>We came up with a hypothetical health scenario and began by asking participants “how likely are you to sanitize your mobile phone?”</p>
<p><em>(26% said they were likely / very likely)</em></p>
<p>298 participants were randomized to treatment and 298 control.</p>
<p><strong>controls</strong> saw statement 1A, a (hypothetical) recommendation from public health experts that you don’t need to sanitize your mobile phone</p>
<p><strong>treated</strong> saw 1B, the same recommendation with added transparent information</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2022-12-14/stat.jpeg" class="img-fluid"> After seeing these statements they were asked again their likelihood to sanitize their mobile phone. Then all participants were shown a second, 🆕 statement — this new statement said based on new information public health experts recommend you <strong>should</strong> sanitize your phone</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2022-12-14/stat-2.jpeg" class="img-fluid"></p>
<p>All participants were again asked after seeing this second statement how likely they were to sanitize their phone (this is our primary endpoint ✅)</p>
<p>We fit proportional odds models stratified by the baseline likelihood to agree with the final advice.</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2022-12-14/plot.jpeg" class="img-fluid"></p>
<p>Among participants who were more likely to agree with the final recommendation at baseline, those who were initially shown uncertainty had a <strong>46</strong>% lower odds of being more likely to agree with the final recommendation compared to those who were not (OR: 0.54, 95% CI: 0.27-1.03).</p>
<p>Among participants who were less likely to agree with the final recommendation at baseline, those who were initially shown uncertainty had <strong>1.61</strong> times the odds of being more likely to agree with the final recommendation compared to those who were not (OR: 1.61, 95% CI: 1.15-2.25)</p>
<p>This has implications for public health leaders when assessing how to communicate a recommendation, suggesting communicating uncertainty influences whether someone will adhere to a future recommendation. Presenting public health recommendations with transparency can both ⬆️ and ⬇️ adherence to future recommendations in the presence of changing evidence, depending on the individuals’ baseline likelihood to do what is being recommended prior to seeing the recommendation. Many public health recommendations, particularly those being made during an ever changing pandemic, have a high probability of changing in the future, making this result highly relevant. For example, the recommendation to 😷 wear masks will come and go depending on the prevalence and impact of the infectious disease of concern in the community. When initially communicating this new recommendation to the public, an explanation of the reasoning for the recommendation as well as any potential uncertainty may have resulted in ⬆️ adherence among those who would not have been likely to wear a mask in the recommended settings. 12% of US respondents in March 2020 reported masking to protect themselves. At the time, the recommendation from the CDC was: “If you are NOT sick: You do not need to wear a face mask unless you are caring for someone who is sick (and they are not able to wear a face mask)”. Based on our results, if the initial recommendation to avoid wearing face masks had been presented with the uncertainty communicated, we might expect some of this 12% to be less likely to follow the recommendation — however! 88% were not likely to wear masks a priori; our results suggest this population may have ultimately had higher compliance with the subsequent recommendation to wear face masks had the initial communication been made with transparency explaining the “why” behind it. This study has lots of limitations (it was only hypothetical!) but I think is a good first step for trying to quantify the impact of the way communications can impact future decisions.</p>
<p><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0278263">Check out the full article here</a></p>


</section>

 ]]></description>
  <category>transparency</category>
  <category>statistical communication</category>
  <guid>https://www.livefreeordichotomize.com/posts/2022-12-14-transparency-in-public-health/index.html</guid>
  <pubDate>Wed, 14 Dec 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.livefreeordichotomize.com/posts/2022-12-14-transparency-in-public-health/featured.jpeg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Migrating from Hugo to Quarto</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2022-09-19-migrating-from-hugo-to-quarto/index.html</link>
  <description><![CDATA[ 




<p>We have migrated our blog from Hugo to Quarto! Here are a few quick tips that made the transition a bit smoother.</p>
<section id="setting-up-a-quarto-website" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-a-quarto-website">1. Setting up a Quarto website</h2>
<p>It is super easy to set up a Quarto website. To get the basic template, you can run the following in your terminal:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">quarto</span> create-project mysite <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--type</span> website</span></code></pre></div>
<p>You can find lots of details about how to customize your site in the <a href="https://quarto.org/docs/websites/">Quarto Docs</a>. The rest of this post will cover a few things that made the transition smooth for us.</p>
</section>
<section id="moving-.rmd-files-from-hugo-to-your-new-site" class="level2">
<h2 class="anchored" data-anchor-id="moving-.rmd-files-from-hugo-to-your-new-site">2. Moving .Rmd files from Hugo to your new site</h2>
<p>In Hugo, my .Rmd files were in the following folder under the main project: <code>content/post</code>. These were often individual files, rather than nested in folders. For my Quarto site, I wanted them in a folder called <code>post</code> and I wanted each post to have it’s only folder with content in a file called <code>index.qmd</code> nested within. I wrote a quick R script to help me do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fs)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pull all .Rmd files from my blog</span></span>
<span id="cb2-4">files_rmd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(</span>
<span id="cb2-5">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/livefreeordichotomize/content/post"</span>,</span>
<span id="cb2-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*.Rmd"</span>)</span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove the .Rmd for the folders</span></span>
<span id="cb2-8">folders <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".Rmd"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, files_rmd)</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pull again, with full names</span></span>
<span id="cb2-11">full_files <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(</span>
<span id="cb2-12">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/livefreeordichotomize/content/post"</span>,</span>
<span id="cb2-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*.Rmd"</span>, </span>
<span id="cb2-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">full.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb2-15"></span>
<span id="cb2-16"></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create folders</span></span>
<span id="cb2-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dir_create</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posts/{folders}"</span>))</span>
<span id="cb2-19"></span>
<span id="cb2-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># copy the .Rmd files into a new folder, named according to the old file name</span></span>
<span id="cb2-21">purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">walk2</span>(</span>
<span id="cb2-22">  full_files, </span>
<span id="cb2-23">  folders, </span>
<span id="cb2-24">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file_copy</span>(.x, glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posts/{.y}/index.qmd"</span>)))</span></code></pre></div>
</div>
</section>
<section id="setting-up-a-404-pages-for-readers-with-old-links" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-a-404-pages-for-readers-with-old-links">3. Setting up a 404 pages for readers with old links</h2>
<p>Since we have rerouted where many of the files are, I set up a 404 page that will allow readers to quickly find a post if they have an old link. To do this, I created a folder in the top of the project called <code>404.qmd</code> containing the following:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Page Not Found</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">listing</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contents</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> posts</span></span>
<span id="cb3-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> table</span></span>
<span id="cb3-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span></span>
<span id="cb3-7"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span></code></pre></div>
<p>This will create a searchable table listing of all of the previous posts, allowing readers to quickly find the link they are looking for.</p>
<p><strong>UPDATE</strong> You can add the old links under an <code>aliases</code> parameter in each posts’ YAML.</p>
</section>
<section id="comments-and-google-analytics" class="level2">
<h2 class="anchored" data-anchor-id="comments-and-google-analytics">4. Comments and Google analytics</h2>
<p>It is straightforward to incorporate comments on your blog – our old site used utterance. Likewise, it is simple to add Google Analytics. To use this in Quarto, we can add the following to the website’s global <code>yaml</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">website</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">comments</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span></span>
<span id="cb4-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">utterances</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">repo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> lfod/lfod.github.io</span></span>
<span id="cb4-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">google-analytics</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UA------"</span></span></code></pre></div>
</div>
<p>To see our full setup, check out our GitHub repo: <a href="https://github.com/LFOD/LFOD.github.io">github.com/LFOD/LFOD.github.io</a></p>
<p>Have other questions? Feel free to leave them in the comments!</p>


</section>

 ]]></description>
  <category>rstats</category>
  <category>quarto</category>
  <category>blog</category>
  <guid>https://www.livefreeordichotomize.com/posts/2022-09-19-migrating-from-hugo-to-quarto/index.html</guid>
  <pubDate>Mon, 19 Sep 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.livefreeordichotomize.com/posts/2022-09-19-migrating-from-hugo-to-quarto/featured.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>tipr: An R package for sensitivity analyses for unmeasured confounding</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2022-09-07-tipr-an-r-package-for-sensitivity-to-unmeasured-confounding/index.html</link>
  <description><![CDATA[ 




<p>The <code>tipr</code> R package has some new features! And a new and improved API!</p>
<section id="what-is-tipr" class="level2">
<h2 class="anchored" data-anchor-id="what-is-tipr">What is <code>tipr</code></h2>
<p><code>tipr</code> is an R package that allows you to conduct sensitivity analyses for unmeasured confounders. Why might you want to do that? Well, as it turns out, the assumption of “no unmeasured confounders” is integral to any estimation of a causal effect. This assumption is untestable, so often the best we can do is examine how far off our estimates would be should an unmeasured confounder exists, hence <strong>sensitivity analyses</strong>!</p>
</section>
<section id="how-do-i-use-tipr" class="level2">
<h2 class="anchored" data-anchor-id="how-do-i-use-tipr">How do I use <code>tipr</code></h2>
<p>You can install the CRAN version by running the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tipr"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tipr)</span></code></pre></div>
</div>
<p>The package comes with a few example data sets. For example, the dataframe <code>exdata_rr</code> is simulated data that can be used to estimate the effect of a binary exposure on a binary outcome, estimated via a risk ratio. This data set has 4 columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">exdata_rr</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,000 × 4
   .unmeasured_confounder measured_confounder exposure
                    &lt;dbl&gt;               &lt;dbl&gt;    &lt;dbl&gt;
 1                0.716                -0.890        0
 2                0.134                -0.249        0
 3                0.238                -0.104        0
 4                0.0286                0.165        0
 5               -0.598                 0.812        0
 6                0.00419              -0.563        0
 7               -0.960                -0.559        0
 8               -1.15                  1.14         0
 9               -0.374                -1.23         0
10                1.80                  0.495        0
# ℹ 1,990 more rows
# ℹ 1 more variable: outcome &lt;int&gt;</code></pre>
</div>
</div>
<p>Using this data, we could estimate the exposure-outcome relationship using the measured confounder as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(</span>
<span id="cb5-2">  outcome <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> exposure <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  measured_confounder,</span>
<span id="cb5-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> exdata_rr,</span>
<span id="cb5-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> poisson)</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## calculate the risk ratio by exponentiating </span></span>
<span id="cb5-7"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## the coefficient</span></span>
<span id="cb5-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(mod) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        (Intercept)            exposure measured_confounder 
         0.03656318          1.49477100          2.42566275 </code></pre>
</div>
</div>
<p>We observe a risk ratio of 1.5 for the exposure after adjusting for the measured confounder. We can then get a confidence interval for this output. Note that here we are using a generalized linear model with a log link (via the Poisson family) to estimate this risk ratio. When estimating the risk ratio using this method, it is important to estimate the variability using <strong>robust standard errors</strong> (a sandwich estimator). In R, you can use the <code>sandwich</code> and <code>lmtest</code> packages to do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">lmtest<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coefci</span>(mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vcov =</span> sandwich<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>vcovHC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         2.5 %     97.5 %
(Intercept)         0.02778992 0.04810614
exposure            1.10497223 2.02207828
measured_confounder 2.13761161 2.75252986</code></pre>
</div>
</div>
<p>Our observed effect, after adjusting for our measured confounder is a risk ratio of 1.5 (95% CI: 1.1, 2.0).</p>
<p>Let’s assume our unmeasured confounder is normally distributed with a mean of 0.5 in the exposed group and 0 in the unexposed (and unit variance in both) resulting in a mean difference of 0.5. We can use this to solve for the relationship between the unmeasured confounder and outcome needed to “tip” the analysis (that is needed to make the observed effect, 1.5, cross 1).</p>
<p>To do this, we are going to use the <code>tip_with_continuous</code> function. We will set the <code>effect_observed</code> to 1.5 and the <code>exposure_confounder_effect</code> to 0.5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tip_with_continuous</span>(</span>
<span id="cb9-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">effect_observed =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,</span>
<span id="cb9-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">exposure_confounder_effect =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb9-4">)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ The observed effect (1.5) WOULD be tipped by 1 unmeasured
  confounder with the following specifications:
• estimated difference in scaled means between the
  unmeasured confounder in the exposed population and
  unexposed population: 0.5
• estimated relationship between the unmeasured confounder
  and the outcome: 2.25</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  effect_adjusted effect_observed exposure_confounder_effect
            &lt;dbl&gt;           &lt;dbl&gt;                      &lt;dbl&gt;
1               1             1.5                        0.5
# ℹ 2 more variables: confounder_outcome_effect &lt;dbl&gt;,
#   n_unmeasured_confounders &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The output is a data frame with 5 variables – in this case, we are interested in the <code>confounder_outcome_effect</code> column, as this tells us the magnitude of the relationship between an unmeasured confounder and outcome needed to tip this analysis. This results in a confounder-outcome effect of 2.25, meaning that a hypothetical unobserved continuous confounder with a mean difference of <code>0.5</code> would need a relationship of at least <code>2.25</code> with the outcome to tip the analysis at the point estimate.</p>
<p>Alternatively, you could look at a range of potential values for the <code>exposure_confounder_effect</code> and plot the relationship.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">tip_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tip_with_continuous</span>(</span>
<span id="cb12-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">effect_observed =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,</span>
<span id="cb12-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">exposure_confounder_effect =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb12-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb12-5">)</span></code></pre></div>
</div>
<p>We could then plot these results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(tip_df,</span>
<span id="cb13-4">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> exposure_confounder_effect, </span>
<span id="cb13-5">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> confounder_outcome_effect)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exposure - unmeasured confounder effect"</span>,</span>
<span id="cb13-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unmeasured confounder - outcome effect"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-09-07-tipr-an-r-package-for-sensitivity-to-unmeasured-confounding/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The line represents the values needed for the unobserved confounder to tip this relationship.</p>
<p>Since this data was simulated, we can calculated what the <em>actual</em> effect is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">mod_actual <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(</span>
<span id="cb14-2">  outcome <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> exposure <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> measured_confounder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> .unmeasured_confounder,</span>
<span id="cb14-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> exdata_rr,</span>
<span id="cb14-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> poisson)</span>
<span id="cb14-5"></span>
<span id="cb14-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(mod_actual) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           (Intercept)               exposure 
            0.02450901             0.92108511 
   measured_confounder .unmeasured_confounder 
            2.43654796             2.41680059 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">lmtest<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coefci</span>(mod_actual, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vcov =</span> sandwich<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>vcovHC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            2.5 %     97.5 %
(Intercept)            0.01801732 0.03333966
exposure               0.68914975 1.23107900
measured_confounder    2.12823267 2.78952863
.unmeasured_confounder 2.10602770 2.77343223</code></pre>
</div>
</div>
<p>The <em>actual</em> risk ratio is 0.9 (95% CI: 0.7, 1.2) (so null!). The actual relationship between the unmeasured confounder and outcome is 2.4. We can also calculate the actual exposure - unmeasured confounder effect:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">exdata_rr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(exposure) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(.unmeasured_confounder))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  exposure      m
     &lt;dbl&gt;  &lt;dbl&gt;
1        0 0.0438
2        1 0.547 </code></pre>
</div>
</div>
<p>The actual difference is <code>0.5</code>. Returning to our plot, we can see that this point is to the right of the “tipping” bound, indicating that this unmeasured confounder is “large” enough to tip our result (which is exactly what we saw! Before adjusting for this, we had a risk ratio of 1.5, after adjusting we observe a “tip” (crossing the null, 1) to 0.9).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(tip_df,</span>
<span id="cb20-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> exposure_confounder_effect, </span>
<span id="cb20-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> confounder_outcome_effect)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotate</span>(</span>
<span id="cb20-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"point"</span>,</span>
<span id="cb20-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb20-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.4</span>,</span>
<span id="cb20-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb20-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"square"</span>,</span>
<span id="cb20-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span></span>
<span id="cb20-13">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exposure - unmeasured confounder effect"</span>,</span>
<span id="cb20-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unmeasured confounder - outcome effect"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-09-07-tipr-an-r-package-for-sensitivity-to-unmeasured-confounding/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="the-details" class="level2">
<h2 class="anchored" data-anchor-id="the-details">The details</h2>
<p>The functions in the tipr package follow a unified grammar. The function names follow this form: <code>{action}_{effect}_with_{what}</code>.</p>
<p>For example, to adjust (<code>action</code>) a coefficient (<code>effect</code>) with a binary unmeasured confounder (<code>what</code>), we use the function <code>adjust_coef_with_binary()</code>.</p>
<p>Below is a copy of the table included in a <a href="https://doi.org/10.21105/joss.04495">recent JOSS article</a> about this package.</p>
<p><strong>Table 1</strong>. Grammar of <code>tipr</code> functions.</p>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 26%">
<col style="width: 58%">
</colgroup>
<thead>
<tr class="header">
<th>category</th>
<th>Function term</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>action</strong></td>
<td><code>adjust</code></td>
<td>These functions adjust observed effects, requiring both the unmeasured | confounder-exposure relationship and unmeasured confounder-outcome relationship to be specified.</td>
</tr>
<tr class="even">
<td></td>
<td><code>tip</code></td>
<td>These functions tip observed effects. Only one relationship, either the unmeasured confounder-exposure relationship or unmeasured confounder-outcome relationship needs to be specified.</td>
</tr>
<tr class="odd">
<td><strong>effect</strong></td>
<td><code>coef</code></td>
<td>These functions specify an observed coefficient from a linear, log-linear, logistic, or Cox proportional hazards model</td>
</tr>
<tr class="even">
<td></td>
<td><code>rr</code></td>
<td>These functions specify an observed relative risk</td>
</tr>
<tr class="odd">
<td></td>
<td><code>or</code></td>
<td>These functions specify an observed odds ratio</td>
</tr>
<tr class="even">
<td></td>
<td><code>hr</code></td>
<td>These functions specify an observed hazard ratio</td>
</tr>
<tr class="odd">
<td><strong>what</strong></td>
<td><code>continuous</code></td>
<td>These functions specify an unmeasured standardized Normally distributed confounder. These functions will include the parameters <code>exposure_confounder_effect</code> and <code>confounder_outcome_effect</code></td>
</tr>
<tr class="even">
<td></td>
<td><code>binary</code></td>
<td>These functions specify an unmeasured binary confounder. These functions will include the parameters <code>exposed_confounder_prev</code>, <code>unexposed_confounder_prev</code>, and <code>confounder_outcome_effect</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>r2</code></td>
<td>These functions specify an unmeasured confounder parameterized by specifying the percent of variation in the exposure / outcom explained by the unmeasured confounder. These functions will include the parameters <code>confounder_exposure_r2</code> and <code>outcome_exposure_r2</code></td>
</tr>
</tbody>
</table>
<p>You can find full documentation here: <a href="https://lucymcgowan.github.io/tipr/">lucymcgowan.github.io/tipr/</a></p>


</section>

 ]]></description>
  <category>rstats</category>
  <guid>https://www.livefreeordichotomize.com/posts/2022-09-07-tipr-an-r-package-for-sensitivity-to-unmeasured-confounding/index.html</guid>
  <pubDate>Thu, 08 Sep 2022 00:00:00 GMT</pubDate>
</item>
<item>
  <title>The Peril of Power when Prioritizing a Point Estimate</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2022-02-22-the-peril-of-power-when-prioritizing-a-point-estimate/index.html</link>
  <description><![CDATA[ 




<p>I recently noticed that the Pfizer immunobridging trials, presumably set up to demonstrate that their COVID-19 vaccines elicit the same antibody response in children as was seen in 16-25 year olds, for whom efficacy has previously been demonstrated, have a strange criteria for “success”.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><strong>GMT:</strong> geometric mean titer. This is a measure of the antibody titers. We use the <em>geometric</em> mean because this data is quite skewed (it is also why you typically see it plotted on the log scale). For those of you who ❤️ math, the equation for the geometric mean is just <img src="https://latex.codecogs.com/png.latex?%5Cexp%5C%7B%5Cfrac%7B%5Csum_%7Bi=1%7D%5En%5Ctextrm%7Blog%7D(x_i)%7D%7Bn%7D%5C%7D"></p>
</div></div><p>The primary endpoint of these trials is <em>geomteric mean titer ratio</em>, that is, the ratio between the geometric mean antibody concentration in the younger age groups compared to the 16-25 year olds’ geometric mean antibody concentration.</p>
<p>According to the <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa2116298">recent write-up from the 5-11 trial in the New England Journal of Medicine</a>, the trials have been set with two measures of success:</p>
<ol type="1">
<li>The lower bound of the GMT ratio must be <img src="https://latex.codecogs.com/png.latex?%5Cge%200.67"></li>
<li>The <em>point estimate</em> of the GMT ratio must be <img src="https://latex.codecogs.com/png.latex?%5Cge%201"></li>
</ol>
<p>The second criteria was originally set by Pfizer to require that the <em>point estimate</em> of the GMT ratio must be <img src="https://latex.codecogs.com/png.latex?%5Cge%200.8">, however after their data lock the FDA requested this to be changed to the higher threshold. While at first glance, this may seem to make sense, after all we often want to make sure that we hold our pediatric trials to a high standard of efficacy, it turns out this change has statistical implications that change the target in ways that are non-standard for non-inferiority trials.</p>
<p>What do I mean? If we believe that the distribution of antibody concentration in children is <em>exactly the same</em> as what we observed in 16-25 year olds, we would expect this second criteria to <em>fail</em> 50% of the time. Why? When doing any trial, we are observing a <em>sample</em>, not the whole population. We expect a certain amount of uncertainty in our estimates. Here is a small example. Below I have generated 10 samples of 250 people from a log normal distribution with a mean of 1142.5 (log mean of 7.04) and a log standard deviation of 0.8. I am comparing this to an observed sample of 253 individuals drawn from the <em>exact</em> same distribution (incidentally, there were 253 16-25 year olds that led to the “benchmark” of a geometric mean of 1142.5).</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Want to try it yourself? You can generate samples from a lognormal distribution in R like this <code>rlnorm(253, mean = 7.040974, sd = 0.8)</code>. You can then compare the geometric mean ratio across several samples generated from the same distribution.</p>
</div></div><div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-02-22-the-peril-of-power-when-prioritizing-a-point-estimate/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice in the above plot that even though the <em>true</em> GMT ratio between these groups should be 1 (they were drawn from the exact same distribution!), when using the point estimate as the threshold for success, we “failed” 50% of the time. It was a coin toss whether this trial succeeded or failed by this criteria.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>The standard error is just the {standard devation} divided by the square-root of the sample size, <img src="https://latex.codecogs.com/png.latex?n">, <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bsd%7D%7B%5Csqrt%7Bn%7D%7D"></p>
</div></div><p>This may not be completely intuitive at first glance, but in fact we can show that the probability of “succeeding” under this criteria is driven by how much better the antibody concentration is in children compared to the benchmark – it is linked to the standard error.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>This standard error multiplier is just the critical value derived from a standard normal distribution at a given quantile. You can calculate any success probability in R using the <code>qnorm()</code> function. For example, if we wanted to know the standard error multiplier we’d need to have at least a 70% chance of succeeding by this criteria, you would run <code>qnorm(0.7)</code>, revealing we’d need to be at least <img src="https://latex.codecogs.com/png.latex?0.52%20%5Ctimes%20%5Ctextrm%7Bstandard%20errors%7D"> better than the target.</p>
</div></div><p>In order to have a probability of success greater than 80%, for example, the childrens’ antibody response would need to be at least <img src="https://latex.codecogs.com/png.latex?0.84%20%5Ctimes"> standard errors <strong>better</strong> than the 16-25 year olds’. To have a probability of success greater than 90%, the childrens’ antibody response would need to be at least <img src="https://latex.codecogs.com/png.latex?1.28%20%5Ctimes"> standard errors <strong>better</strong> than the 16-25 year olds’.</p>
<p>As many have pointed out, it is not uncommon for pediatric trials to be held to a higher standard, often requiring efficacy beyond what is required of adults due to an appropriate caution against intervention in an often vulnerable group. I fully believe that the regulators that requested this had every best intention in doing so. In this particular case, however, this type of threshold can potentially lead to the <em>opposite</em> effect. By requiring the younger children to mount a <em>higher</em> antibody response than the older cohort in order to pass regulatory hurdles, we may be inadvertently pushing towards higher dosing, for example.</p>
<p>It is possible that the choice of 1 was made with the full understanding that the truth had to be <strong>better</strong> than 1 to pass that threshold with any amount of confidence, but it is important that everyone who contributes to decisions about thresholds understands both the math and the rationale for the choice.</p>
<p>Is this why the 2-4 year old vaccine failed previously? It’s not totally clear since the data hasn’t been released, however based on the tid bits we’ve gotten from media reports, I don’t think so. <a href="https://www.nytimes.com/2022/02/11/us/politics/fda-children-pfizer-vaccine.html">The New York Times reported</a>, for example, that the 2-4 vaccine only elicited 60% of the response compared to the 16-25 year olds, suggesting that it would have failed by the lower bound criteria alone. So why does this matter? Presumably, these thresholds will be used to compare the post-3rd dose response to the 16-25 year olds as well – does it make sense to require the under 5s to have a <strong>stronger</strong> antibody response than the 16-25 year olds? Especially with no other option for protection via a vaccine for this age group, I would say no.</p>



 ]]></description>
  <category>COVID-19</category>
  <category>non-inferiority trials</category>
  <category>clinical trials</category>
  <category>power</category>
  <guid>https://www.livefreeordichotomize.com/posts/2022-02-22-the-peril-of-power-when-prioritizing-a-point-estimate/index.html</guid>
  <pubDate>Mon, 21 Feb 2022 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Exploring the impacts of noninferiority trial thresholds</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index.html</link>
  <description><![CDATA[ 




<p>This post explores the impact of setting particular criteria for “success” in clinical trial designs. A common study design is a “non-inferiority” trial. The goal here is to show that some intervention is <em>not inferior</em>, that is not worse, than some already approved intervention, by some specific definition of <em>not worse</em>. While this may sound straightforward, it can be tricky! Especially because in all clinical trials we are working with a <em>sample</em> of individuals, so there is necessarily uncertainty around the estimates we can calculate. Also, the definition of <em>not worse</em> can vary.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>The standard error is just the {standard devation} divided by the square-root of the sample size, <img src="https://latex.codecogs.com/png.latex?n">, <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bsd%7D%7B%5Csqrt%7Bn%7D%7D"></p>
</div></div><p>In statistics speak, this <em>uncertainty</em> is often quantified as a <em>standard error</em>, a measure that takes into account both the standard deviation of our outcome of interest and the number of people we have measured this outcome on. What do I mean? Here is an example.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><strong>GMT:</strong> geometric mean titer. This is a measure of the antibody titers. We use the <em>geometric</em> mean because this data is quite skewed (it is also why you typically see it plotted on the log scale). For those of you who ❤️ math, the equation for the geometric mean is just <img src="https://latex.codecogs.com/png.latex?%5Cexp%5C%7B%5Cfrac%7B%5Csum_%7Bi=1%7D%5En%5Ctextrm%7Blog%7D(x_i)%7D%7Bn%7D%5C%7D"></p>
</div></div><p>Let’s say we want to know whether <code>new intervention</code> is not inferior to <code>benchmark intervention</code> with respect to some measure, in this case we are going to use the geometric mean titers (GMT), a common measure of antibody response. In this first example, the <em>truth</em> is these two interventions yield the same <code>GMT</code>, that is, they are equivalent, so <code>new intervention</code> is not inferior to <code>benchmark intervention</code>. Let’s say we have a sample of 253 people who received the benchmark intervention. The <em>truth</em> is that <code>GMT</code> is 1142.5 with a standard deviation of 0.8. We won’t see these <em>exact</em> results in our benchmark intervention group since we’re just looking at one sample of 253. The plot below shows what our 253 folks could look like if we were to collect these data 10 different times. The circles represent the <code>GMT</code> in each sample and the lines show the 95% confidence intervals.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Note: If we were trying to conduct a hypothesis test to establish whether the mean was different from 1142, and we collected these same 10 samples, the 4th sample would result in a <em>Type 1 error</em>, that is we’d reject the null hypothesis that the mean is equal to 1142 even though that is the <em>truth</em>. When using 95% confidence intervals, we expect to see a <em>Type 1 error</em> 5% of the time.</p>
</div></div><p>In reality, we would only see <em>one</em> of these results. Notice how some of these estimates differ from what we know is the <em>truth</em> (a GMT of 1142), for example the 4th sample had a geometric mean of 980 – this is expected. In fact, based on what we know about confidence intervals, if we repeat this process 100 times, we’d expect about 5 of these intervals to not contain 1142 <em>at all</em>. Notice the width of the confidence intervals is generally the same. This is determined by the standard deviation (which here is 0.8) and the sample size (253).</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ok, so let’s say we observed the 10th sample in the plot above (<code>GMT</code>: 1146.5 (95% CI: 1257.2, 1045.5)). We want to show that some <code>new intervention</code> yields a <code>GMT</code> that is not inferior (not worse) than this benchmark intervention. One way we could do that is collect data on the new intervention, compare it to the old, and set some <em>criteria</em> for “success”. What would make this <code>new intervention</code> not inferior? Let’s see what happens if we set our criteria for success to be that the geometric mean titers among our sample of those in the <code>new intervention</code> group is not less than the geometric mean we observed in our <code>benchmark intervention</code> sample. Another way to look at this is to look at the <em>ratio</em> between our two geometric means, the GMT in the <code>new intervention</code> divided by the GMT in the <code>old intervention</code> group. If this ratio is equal to one, they are the same, if the ratio is less than 1, the <code>new intervention</code> is deemed “worse” (inferior) and if the ratio is greater than 1, the <code>new intervention</code> is better. Another way to state this criteria is that the GMT ratio needs to be <img src="https://latex.codecogs.com/png.latex?%5Cge%201">.</p>
<section id="scenario-1-by-non-inferiority-we-mean-the-observed-point-estimates-will-be-equal-or-the-point-estimate-for-the-new-group-will-be-higher" class="level3">
<h3 class="anchored" data-anchor-id="scenario-1-by-non-inferiority-we-mean-the-observed-point-estimates-will-be-equal-or-the-point-estimate-for-the-new-group-will-be-higher">Scenario 1: By “non-inferiority” we mean the observed point estimates will be equal <em>or</em> the point estimate for the new group will be higher</h3>
</section>
<section id="threshold-gmt-ratio-ge-1" class="level3">
<h3 class="anchored" data-anchor-id="threshold-gmt-ratio-ge-1">Threshold: GMT ratio <img src="https://latex.codecogs.com/png.latex?%5Cge%201"></h3>
<p>I am going to generate some <code>new intervention</code> samples, remember we only observe one of these in reality. I am generating them from the <em>same distribution</em> as the <code>old intervention</code>, so the <em>truth</em> here is that the two are equal (and thus also non-inferior). Remember that to generate these samples we also need to know the <em>sample size</em>. Let’s assume the sample size is the same (253).</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot above shows 10 random samples from our <code>new intervention</code>. Remember that these were generated exactly like our <code>old intervention</code>, so the <em>truth</em> is that they are equivalent (and thus it is also true that the <code>new intervention</code> is not inferior, not worse, than the old). Notice here, 50% of the samples “failed” (in orange in the plot above) by our criteria that the geometric mean (the point estimate) of our <code>new intervention</code> had to be greater than or equal to our observed geometric mean in the <code>old intervention</code>. This is exactly what we’d expect to happen! Because there is some random chance involved (we are only looking at a sample), the probability of falling on either side of a point estimate is going to be a coin toss when the “truth” is centered there.</p>
<p>Often, the criteria for non-inferiority trials is set based on a <em>lower bound</em> threshold instead. For example, we could say we want to have some certainty that the <code>new intervention</code> is not some percent <em>worse</em> than the old. Maybe we set our lower bound to 0.67. This would mean that in order to be deemed a “success” the lower bound of our geometric mean ratio between the old and new interventions would need to exceed 0.67. Looking at the plot above, this seems easy! However, if we assume the same standard deviation (0.8) and same sample size (253), we can achieve this threshold even if the new intervention is statistically significantly worse. Let’s see that.</p>
</section>
<section id="scenario-2-by-non-inferiority-we-mean-we-can-have-some-level-of-confidence-that-the-new-intervention-is-not-more-than-67-worse-than-the-old" class="level3">
<h3 class="anchored" data-anchor-id="scenario-2-by-non-inferiority-we-mean-we-can-have-some-level-of-confidence-that-the-new-intervention-is-not-more-than-67-worse-than-the-old">Scenario 2: By “non-inferiority” we mean we can have some level of confidence that the new intervention is not more than 67% worse than the old</h3>
</section>
<section id="threshold-gmt-ratio-lower-bound-ge-0.67" class="level3">
<h3 class="anchored" data-anchor-id="threshold-gmt-ratio-lower-bound-ge-0.67">Threshold: GMT ratio <em>lower bound</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%200.67"></h3>
<p>Now I am going to assume that the <em>truth</em> is that the <code>new intervention</code> is only 75% as good as the old, meaning the <em>true</em> ratio between the two is 0.75. This would equate to being around 6 standard errors <em>worse</em> than equal, so pretty bad. Let’s generate some samples under this assumption and see how we do.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Our lower bound threshold of 0.67 “caught” our inferior samples ~70% of the time here (in orange), but notice there were three samples that would be considered “successful” by this metric (blue), even though the full confidence interval falls below 1. How likely something like this is to occur depends on two things:</p>
<ol type="1">
<li>the standard deviation of the outcome in <code>new intervention</code> group</li>
<li>the sample size of the <code>new intervention</code> group</li>
</ol>
<p>Often clinical trials need to <em>prespecify</em> their sample size, so we can guard against one of these, but the standard deviation is often just a guess. For example, what if the standard deviation in the <code>new intervention</code> group was much smaller, say half of the standard deviation in the <code>old intervention</code> group. Let’s see what that looks like.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice in the plot above with the smaller standard deviations, the confidence intervals shrunk! Now we have 60% successes, all with upper bounds less than 1 😱. This is why often a second criteria is set to guard against this possibility. In the past, I have often seen this as a criteria for the upper bound – for example, you could require that the upper bound not be less than 1 to exclude the possibility of a “success” when the new intervention is in fact statistically significantly worse. Why not <em>only</em> set an upper bound criterion? If we did that, we could have the opposite scenario where the <em>true</em> standard deviation is much larger than expected, so despite the upper bound being above one, the confidence interval spans a very large range (like below!).</p>
</section>
<section id="scenario-3-by-non-inferiority-we-mean-the-new-intervention-is-not-statistically-significantly-worse-than-the-old-intervention" class="level3">
<h3 class="anchored" data-anchor-id="scenario-3-by-non-inferiority-we-mean-the-new-intervention-is-not-statistically-significantly-worse-than-the-old-intervention">Scenario 3: By “non-inferiority” we mean the new intervention is not statistically significantly worse than the old intervention</h3>
</section>
<section id="threshold-gmt-ratio-upper-bound-ge-1" class="level3">
<h3 class="anchored" data-anchor-id="threshold-gmt-ratio-upper-bound-ge-1">Threshold: GMT ratio <em>upper bound</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%201"></h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Including both criteria would guard against this. Let’s look at that across all of the scenarios we’ve explored so far.</p>
</section>
<section id="scenario-4-by-non-inferiority-we-mean-we-can-have-some-level-of-confidence-that-the-new-intervention-is-not-more-than-67-worse-than-the-old-and-the-new-intervention-is-not-statistically-significantly-worse-than-the-old-intervention" class="level3">
<h3 class="anchored" data-anchor-id="scenario-4-by-non-inferiority-we-mean-we-can-have-some-level-of-confidence-that-the-new-intervention-is-not-more-than-67-worse-than-the-old-and-the-new-intervention-is-not-statistically-significantly-worse-than-the-old-intervention">Scenario 4: By “non-inferiority” we mean we can have some level of confidence that the new intervention is not more than 67% worse than the old and the new intervention is not statistically significantly worse than the old intervention</h3>
</section>
<section id="thresholds-gmt-ratio-lower-bound-ge-0.67-and-gmt-ratio-upper-bound-ge-1" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="thresholds-gmt-ratio-lower-bound-ge-0.67-and-gmt-ratio-upper-bound-ge-1">Thresholds: GMT ratio <em>lower bound</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%200.67"> AND GMT ratio <em>upper bound</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%201"></h3>

<div class="no-row-height column-margin column-container"><div class="">
<p>Remember, I’m showing you 10 different possible sampling scenarios generated under the same “truth”. In reality, we’d only observe one of these. The reason I’m showing 10 is so you can see the <em>probability</em> of success or failure based on the criteria and the truth.</p>
</div></div><div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Beautiful! Now we are failing when we should be, regardless of our standard deviation, and succeeding when we should be (when the truth is that the two groups are the same). What we’ve seen so far is similar to how the immunobridging Pfizer trial was designed to evaluate vaccines in kids. Because Pfizer didn’t think they would have enough time or participants to accurately estimate the <em>efficacy</em> of the vaccine in young children, they instead designed a trial to compare their antibody response to the antibody response seen in 16-25 year olds, for whom they <em>were</em> able to demonstrate efficacy. The thinking being: if the antibody levels in kids is comprable to that in 16-25 year olds, then hopefully the efficacy will be comparable too. The issue, of course, is what do they mean by <em>comparable</em> (or <em>not inferior</em>). Originally they designed this with two thresholds: the <em>lower bound</em> needed to be <img src="https://latex.codecogs.com/png.latex?%5Cge%200.67"> and the <em>point estimate</em> needed to be <img src="https://latex.codecogs.com/png.latex?%5Cge%200.8">. This is similar to scenario 4, but there are important differences, which brings me to scenario 5!</p>
</section>
<section id="scenario-5-by-non-inferiority-we-mean-we-can-have-some-level-of-confidence-that-the-new-intervention-is-not-more-than-67-worse-than-the-old-and-the-new-intervention-and-even-more-confidence-that-it-is-not-more-than-80-worse-than-the-old-intervention" class="level3">
<h3 class="anchored" data-anchor-id="scenario-5-by-non-inferiority-we-mean-we-can-have-some-level-of-confidence-that-the-new-intervention-is-not-more-than-67-worse-than-the-old-and-the-new-intervention-and-even-more-confidence-that-it-is-not-more-than-80-worse-than-the-old-intervention">Scenario 5: By “non-inferiority” we mean we can have some level of confidence that the new intervention is not more than 67% worse than the old and the new intervention and even more confidence that it is not more than 80% worse than the old intervention</h3>
</section>
<section id="thresholds-gmt-ratio-lower-bound-ge-0.67-and-gmt-ratio-point-estimate-ge-0.8" class="level3">
<h3 class="anchored" data-anchor-id="thresholds-gmt-ratio-lower-bound-ge-0.67-and-gmt-ratio-point-estimate-ge-0.8">Thresholds: GMT ratio <em>lower bound</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%200.67"> AND GMT ratio <em>point estimate</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%200.8"></h3>
<p>Fixing a non-inferiority bound at a point estimate introduces some complications. By not taking the upper bound into account, we don’t fully guard against seeing a statistically significantly <em>worse</em> result that “succeeds” by our criteria. For example, consider the scenario where the “truth” is that the <code>new intervention</code> is 85% as good as the old. This passes our definition of “non-inferiority”, but we could end up with many cases where the new intervention is statistically significantly worse but still “successful”. Much of these decisions need to be grounded both in the statistics <em>and</em> the science. If it is deemed scientifically acceptable that generating 85% of an antibody response is ok, then this is a fine threshold.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This will succeed 90% of the time, but notice that but notice that 8 of the 9 “successes” the confidence interval indicates that the intervention is statistically significantly worse.</p>
<p>It turns out, after Pfizer finished their 5-11 trial, <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa2116298">the FDA requested that they move this second threshold to be more stringent.</a>. Instead of needing a <em>point estimate</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%200.8">, they now needed a <em>point estimate</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%201">.</p>
<p>This is where things get tricky! Recall from the very first scenario that we looked at that setting a threshold based on the point estimate like this will <strong>fail 50% of the time</strong> even if the truth is that the two groups are exactly equal. By imposing this new threshold, the FDA is essentially requiring that the antibody response in children by <strong>superior</strong> to that in 16-25 year olds, not just <em>not inferior</em>. In addition, setting this threshold like this essentially renders the lower bound moot unless the variability in antibody response is much larger in young children compared to 16-25 year olds. In fact, in order for that “lower bound <img src="https://latex.codecogs.com/png.latex?%5Cge%200.67">” threshold to be invoked while the “point estimate <img src="https://latex.codecogs.com/png.latex?%5Cge%201">” succeeds, the actual standard deviation in the young children’s antibody titers would need to be about 4 times that observed in the older cohort. This threshold (the need to have the point estimate <img src="https://latex.codecogs.com/png.latex?%5Cge%201">) basically sets a large “weight” on the younger antibody response needing to be much <strong>stronger</strong> than that observed in the older cohort. Let’s take the 2-4 year olds as an example.</p>
</section>
<section id="scenario-6-by-non-inferiority-we-mean-we-can-have-some-level-of-confidence-that-the-new-intervention-is-not-more-than-67-worse-than-the-old-and-the-new-intervention-and-even-more-confidence-that-it-is-not-any-worse-than-the-old-intervention" class="level3">
<h3 class="anchored" data-anchor-id="scenario-6-by-non-inferiority-we-mean-we-can-have-some-level-of-confidence-that-the-new-intervention-is-not-more-than-67-worse-than-the-old-and-the-new-intervention-and-even-more-confidence-that-it-is-not-any-worse-than-the-old-intervention">Scenario 6: By “non-inferiority” we mean we can have some level of confidence that the new intervention is not more than 67% worse than the old and the new intervention and even more confidence that it is not <em>any</em> worse than the old intervention</h3>
</section>
<section id="thresholds-gmt-ratio-lower-bound-ge-0.67-and-gmt-ratio-point-estimate-ge-1" class="level3">
<h3 class="anchored" data-anchor-id="thresholds-gmt-ratio-lower-bound-ge-0.67-and-gmt-ratio-point-estimate-ge-1">Thresholds: GMT ratio <em>lower bound</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%200.67"> AND GMT ratio <em>point estimate</em> <img src="https://latex.codecogs.com/png.latex?%5Cge%201"></h3>
<p>If we think that an antibody response <em>exactly equal</em> to that seen by 16-25 year olds is sufficient to deem this vaccine <em>non inferior</em>, then this is not the right threshold, as a trial testing this way will <strong>fail 50% of the time</strong>. That is, the chance of failing is a coin toss, even if the two groups are exactly equal. Below shows this again. Remember for a given trial, we are only lucky enough to see <em>one</em> of these outcomes in the plot below; I am showing 10 so you can see the variation based on the sampling variability.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Statistically, in order to have a 85% chance of “success”, the truth would need to be that the antibody response in kids is ~1 standard error higher compared to 16-25 year olds. This is based on basic normal theory. It turns out if a variable is log normally distributed, the geometric mean is equivalent to the median of the distribution, which ties to the mean of the <em>normal</em> distribution. Therefore, we can use basic normal theory to understand the impact of requiring the <em>point estimate</em> of a distribution to be greater than some value. Assuming that the <em>truth</em> is that this point estimate (the GMT ratio) is 1 <img src="https://latex.codecogs.com/png.latex?%5Ctimes"> x [standard errors], and you take a sample from a log normally distributed population, the probability that the GMT ratio that you <em>observe</em> is 1 is equal to <code>qnorm(x)</code>. For example, if the <em>truth</em> is that the GMT ratio is 1 <img src="https://latex.codecogs.com/png.latex?%5Ctimes%201.96"> [standard errors], and you ran this trial a bunch of times, you would expect a “success” 95% of the time. (The 5% of the time that you saw a “failure” would be considered a Type II error).</p>
<p>SO what does this mean? Well it depends on what the standard deviation ends up being for 2-4 year old antibody response. If it is the same as 16-25 year olds, in order to avoiding making a Type II error more than 15% of the time, the geometric mean of the antibody response in 2-4 year olds would need to be 5-6% higher than what was observed in 16-25 year olds. If their standard deviation is actually <em>larger</em> this will increase, for example if it was 2, the <em>true</em> antibody response in 2-4 year olds would need to be ~ 14% higher.</p>
<p>As many have pointed out, it is not uncommon for pediatric trials to be held to a higher standard, often requiring efficacy beyond what is required of adults due to an appropriate caution against intervention in an often vulnerable group. I fully believe that the regulators that requested this had every best intention in doing so. In this particular case, however, this type of threshold can potentially lead to the <em>opposite</em> effect. By requiring the younger children to mount a <em>higher</em> antibody response than the older cohort in order to pass regulatory hurdles, we may be inadvertently pushing towards higher dosing, for example.</p>
<p>Is this why the 2-4 year old vaccine failed previously? It’s not totally clear since the data hasn’t been released, however based on the tid bits we’ve gotten from media reports, I don’t think so. <a href="https://www.nytimes.com/2022/02/11/us/politics/fda-children-pfizer-vaccine.html">The New York Times reported</a>, for example, that the 2-4 vaccine only elicited 60% of the response compared to the 16-25 year olds, suggesting that it would have failed by the lower bound criteria alone. So why does this matter? Presumably, these thresholds will be used to compare the post-3rd dose response to the 16-25 year olds as well – does it make sense to require the under 5s to have a <strong>stronger</strong> antibody response than the 16-25 year olds? Especially with no other option for protection via a vaccine for this age group, I would say no.</p>


</section>

 ]]></description>
  <guid>https://www.livefreeordichotomize.com/posts/2022-02-20-exploring-impacts-of-noninferiority-thresholds/index.html</guid>
  <pubDate>Sun, 20 Feb 2022 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Would seeing Spider-Man: No Way Home decrease COVID-19 Cases?</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2022-01-16-would-seeing-spider-man-no-way-home-decrease-covid19-cases/index.html</link>
  <description><![CDATA[ 




<p>In SNL’s cold open last night, “President Joe Biden” suggested that the COVID-19 surge we are seeing in the US is due to people seeing Spider-Man: No Way Home. If people would just stop seeing this film, he argues, cases will go back down! Interesting hypothesis, let’s take a looksy at the data, shall we?</p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
And now, a message from President Joe Biden. <a href="https://t.co/Q8TglFNBlF">pic.twitter.com/Q8TglFNBlF</a>
</p>
— Saturday Night Live - SNL (<span class="citation" data-cites="nbcsnl">@nbcsnl</span>) <a href="https://twitter.com/nbcsnl/status/1482574817035444227?ref_src=twsrc%5Etfw">January 16, 2022</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>I pulled the domestic box office data from <a href="https://www.the-numbers.com/movies/custom-comparisons/Spider-Man-No-Way-Home-(2021)#tab=day_by_day_comparison">the-numbers.com</a> and put them in <code>spiderman.csv</code> (if you want to code along, you can do the same! My .csv has two columns: <code>date</code> and <code>domestic_box_office</code>) and US COVID-19 cases from the <a href="https://github.com/nytimes/covid-19-data">NY Times GitHub repository</a>. Here’s a little code-along.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"></span>
<span id="cb1-3">spiderman <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spiderman.csv"</span>,</span>
<span id="cb1-4">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols</span>(</span>
<span id="cb1-5">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%m/%d/%y"</span>),</span>
<span id="cb1-6">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">domestic_box_office =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">col_double</span>()</span>
<span id="cb1-7">                      ))</span>
<span id="cb1-8">cases <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/nytimes/covid-19-data/raw/master/us.csv"</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get daily cases from cumulative cases</span></span>
<span id="cb1-11">cases <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cases <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">case =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(cases[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(cases)))</span>
<span id="cb1-13"></span>
<span id="cb1-14">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> spiderman <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(cases)</span></code></pre></div>
</div>
<p>Now, let’s look at the relationship between daily domestic box office and new COVID-19 cases in the US.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Warning: The following is a very silly analysis. It is a joke. Please do not try at home!</p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(case <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> domestic_box_office, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> d)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = case ~ domestic_box_office, data = d)

Coefficients:
        (Intercept)  domestic_box_office  
          3.559e+05           -3.691e-03  </code></pre>
</div>
</div>
<p>Oh my heavens! Not only does it not look like ticket sales for Spider-Man: No Way Home are increasing COVID-19 cases…it looks like the <em>opposite</em>. According to our very silly model, every $1,000 dollar increase in domestic box office sales results in a <em>decrease</em> of 3-4 COVID-19 cases! Pandemic solved! We just need to buy more Spider-Man: No Way Home tickets!! Since we’re looking at a silly analysis, let’s do something horrible, shall we? A double y-axis!</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>I just learned about the <a href="https://github.com/AllanCameron/geomtextpath">geomtextpath</a> package from <span class="citation" data-cites="timelyportfolio">@timelyportfolio</span> on <a href="https://twitter.com/timelyportfolio/status/1469683836107866120">Twitter</a>, it’s amazing!</p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(geomtextpath)</span>
<span id="cb4-2"></span>
<span id="cb4-3"></span>
<span id="cb4-4">d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(domestic_box_office, case)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"case"</span>, value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, value),</span>
<span id="cb4-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"domestic_box_office"</span>, </span>
<span id="cb4-9">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spiderman daily domestic box office"</span>, </span>
<span id="cb4-10">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"US daily COVID-19 cases"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> name)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_textsmooth</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> name), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,</span>
<span id="cb4-14">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spiderman Daily Domestic Box Office"</span>, </span>
<span id="cb4-16">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>dollar,</span>
<span id="cb4-17">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sec.axis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sec_axis</span>(</span>
<span id="cb4-18">                       <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> . <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, </span>
<span id="cb4-19">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>comma, </span>
<span id="cb4-20">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily new COVID-19 cases in the US"</span>)</span>
<span id="cb4-21">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"@LucyStats"</span>)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021-12-07"</span>), <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-01-16-would-seeing-spider-man-no-way-home-decrease-covid19-cases/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The actual SNL sketch claimed there was a one week lag – that Spider-Man sales a week ago caused cases 7 days later. Let’s check that too!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">cases <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cases <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">case_lag =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lead</span>(case, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)) </span>
<span id="cb5-3"></span>
<span id="cb5-4">spiderman <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(cases) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(domestic_box_office, case_lag)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"case_lag"</span>, value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, value),</span>
<span id="cb5-9">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"domestic_box_office"</span>, </span>
<span id="cb5-10">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spiderman daily domestic box office"</span>, </span>
<span id="cb5-11">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"US daily COVID-19 cases (7 days later)"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> name)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_textsmooth</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> name), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>,</span>
<span id="cb5-15">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spiderman Daily Domestic Box Office"</span>, </span>
<span id="cb5-17">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>dollar,</span>
<span id="cb5-18">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sec.axis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sec_axis</span>(</span>
<span id="cb5-19">                       <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> . <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, </span>
<span id="cb5-20">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>comma, </span>
<span id="cb5-21">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily new COVID-19 cases in the US (7 days later)"</span>)</span>
<span id="cb5-22">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"@LucyStats"</span>)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021-12-07"</span>), <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2022-01-16-would-seeing-spider-man-no-way-home-decrease-covid19-cases/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Well there you have it. It looks like SNL was onto something, but got it backwards! Just kidding.</p>
<p>So <em>new</em> claim! a higher Spider-Man: No Way Home domestic box office would lead to <em>fewer</em> COVID-19 cases. Let’s talk about how we can think about this claim from a <em>causal</em> perspective if it was presented as I have done here. There are lots of ways to introduce causal thinking; in my class, one of the first ways I like to get my students thinking about causal assumptions is via Hill’s Criteria. These are 9 things to think about when trying to assess whether an association is causal; it is not meant to be a checklist (and the list is not exhaustive!) but I find it is a nice way to dip your toe into causal thinking.</p>
<section id="strength" class="level2">
<h2 class="anchored" data-anchor-id="strength">Strength</h2>
<p>The first criteria is what is the <em>strength</em> of the association. Our goofy linear model suggested that 16% of the variability in the number of daily cases in the US could be explained by the Spider-Man: No Way Home domestic box office. Is this strong? The coefficient in our linear model suggests that every $1,000 dollar increase in domestic box office sales results in a <em>decrease</em> of 3-4 COVID-19 cases! That sounds pretty strong? I’m not sure this criteria is helping me assess whether this relationship is causal so I’m going to move on to the next one and rate strength as 🤷.</p>
</section>
<section id="consistency" class="level2">
<h2 class="anchored" data-anchor-id="consistency">Consistency</h2>
<p>Have other studies shown a similar association? I’m going to say no…consistency is going to get rated as 👎.</p>
</section>
<section id="specificity" class="level2">
<h2 class="anchored" data-anchor-id="specificity">Specificity</h2>
<p>Specificity means the exposure of interest (in this case Spider-Man domestic box office) only causes one thing (and that thing is a decrease in COVID-19 cases in this case). I’m going to go with no again. 👎.</p>
</section>
<section id="temporality" class="level2">
<h2 class="anchored" data-anchor-id="temporality">Temporality</h2>
<p>Does the cause precede the effect? Kind of? It looks like sales are decreasing rapidly from Dec 7th through Dec 20 and cases appear to dramatically increase thereafter? But wait! Could the opposite be true? What if the surge in COVID-19 cases is causing a decrease in box office sales? (Acutally there may be some merit to this, but also we can just look at box office trends and see that they tend to decrease over time since lots of excited people go the first weekend and fewer as time goes on but I DIGRESS!) I’m going to give this a 🤷.</p>
</section>
<section id="biological-gradient" class="level2">
<h2 class="anchored" data-anchor-id="biological-gradient">Biological gradient</h2>
<p>Do we see a dose effect? Indeed we do! As domestic box office decreases, COVID-19 cases increase, so can we infer the opposite, if domestic box office sales were to increase, would we see <em>fewer</em> COVID-19 cases? From our little window of data it looks like we can’t know (but reality check, if we had started the analysis from the day before, we actually have box office going from 0 to $121,964,712 and we don’t see a precipitous drop in COVID-19 cases, so I’m going to give this one a 👎).</p>
</section>
<section id="plausibility" class="level2">
<h2 class="anchored" data-anchor-id="plausibility">Plausibility</h2>
<p>Is this plausible? No, it’s silly. 👎</p>
</section>
<section id="coherence" class="level2">
<h2 class="anchored" data-anchor-id="coherence">Coherence</h2>
<p>Is there a coherent argument to be made? Again, no. 👎</p>
</section>
<section id="experiment" class="level2">
<h2 class="anchored" data-anchor-id="experiment">Experiment</h2>
<p>Was there a randomized trial // some attempt at estimating a causal effect to explore this relationship? Nope. 👎</p>
</section>
<section id="analogy" class="level2">
<h2 class="anchored" data-anchor-id="analogy">Analogy</h2>
<p>Is there strong evidence for a similar exposure (something like Spider-Man box office sales) to cause a similar outcome (a decrease in COVID-19 cases in the US)? Nope. 👎</p>
<p>Ok, so using these criteria, let’s assess the overall likelihood of a causal effect:</p>
<p><strong>Strength</strong> 🤷<br>
<strong>Consistency</strong> 👎<br>
<strong>Specificity</strong> 👎<br>
<strong>Temporality</strong> 🤷<br>
<strong>Biological gradient</strong> 👎<br>
<strong>Plausibility</strong> 👎<br>
<strong>Coherence</strong> 👎<br>
<strong>Experiment</strong> 👎<br>
<strong>Analogy</strong> 👎</p>
<p>I’m going to go ahead and rate this one 👎 not likely causal! Sorry! Looks like increasing box office sales of Spider-Man: No Way Home is not likely to get us out of the pandemic.</p>


</section>

 ]]></description>
  <category>covid-19</category>
  <category>statistics</category>
  <category>causal inference</category>
  <guid>https://www.livefreeordichotomize.com/posts/2022-01-16-would-seeing-spider-man-no-way-home-decrease-covid19-cases/index.html</guid>
  <pubDate>Sun, 16 Jan 2022 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Vaccine effectiveness and breakthrough cases</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2021-08-17-vaccine-effectiveness-and-breakthrough-cases/index.html</link>
  <description><![CDATA[ 




<p>I’m seeing lots of confusion around the <em>frequency</em> of breakthrough cases and the effectiveness of vaccines (in fact, a recent interview I did resulted in a confusing headline on this topic!) so let’s dive in!</p>
<p>Vaccine effectiveness is a relative measure, it tells us how protected you will be relative to an unvaccinated person. Even with delta, this looks ok for infections (and <em>very good</em> for severe illness)</p>
<section id="scenario-1" class="level3">
<h3 class="anchored" data-anchor-id="scenario-1">Scenario 1:</h3>
<p>🤒 if an unvaccinated person has a 10% chance of getting sick<br>
💉 and we think the vaccine effectiveness is 60%<br>
💪 a vaccinated person’s chance of getting sick is only 4%</p>
<p>Why? Here’s the math:</p>
<center>
<p>Vaccine effectiveness is:</p>
<p>(risk unvaxed - risk vaxed) / (risk unvaxed)</p>
<p>(.10 - .04) / .10 = 0.6</p>
<p>-or-</p>
<p>Risk for vaccinated is:</p>
<p>risk unvaxed - (vaccine effectiveness x risk unvaxed)</p>
<p>.10 - (.60 x .10) = .04</p>
</center>
<p>But what if there is more virus around / fewer mitigation efforts in place?</p>
</section>
<section id="scenario-2" class="level3">
<h3 class="anchored" data-anchor-id="scenario-2">Scenario 2</h3>
<p>With more virus around /fewer mitigation efforts in place, everyone’s risk may increase by 2.5x</p>
<p>🤒 an unvaccinated person has a 25% chance of getting sick<br>
💉 we still think the vaccine effectiveness is 60%<br>
💪 a vaccinated person’s chance of getting sick is 10%</p>
<p>In these scenarios, the vaccine effectiveness didn’t change, but the risk for the vaccinated increased because the overall risk increased. In fact in Scenario 2 the risk to the vaccinated person was equal to the risk of the unvaccinated person in Scenario 1!</p>
<p>Why does this matter? Breakthrough cases are going to be more frequent for this exact reason. It doesn’t mean the vaccine isn’t effective, it means everyone’s baseline risk is increasing because Covid-19 is just more prevalent everywhere.</p>
<p>There is hope, though! There are many things we can do to bring that baseline risk back down!</p>
<p>💉 get more people vaccinated<br>
😷 mask up<br>
🧪 make liberal use of testing<br>
⚠️ use caution when possible until things improve</p>


</section>

 ]]></description>
  <category>covid-19</category>
  <category>statistics</category>
  <guid>https://www.livefreeordichotomize.com/posts/2021-08-17-vaccine-effectiveness-and-breakthrough-cases/index.html</guid>
  <pubDate>Tue, 17 Aug 2021 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Denominators Matter</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2021-07-21-denominators-matter/index.html</link>
  <description><![CDATA[ 




<p>I’ve seen a lot today about how effective the vaccines are; mistakes aside, lots of folks seem to be mixing up which denominators matter - good thing statisticians <em>LOVE</em> denominators!</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2021-07-21/effective.gif" class="img-fluid"></p>
<p>If you see something like x% of the sick/hospitalized/deceased were vaccinated, the <em>better</em> the vaccine uptake the <em>scarier</em> this number will seem! It is using the wrong denominator. For example, here is a scenario with 90% vaccination, 4 people got sick: 2 vaccinated 2 unvaccinated:</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2021-07-21/scenario.jpeg" class="img-fluid"></p>
<p>In this scenario, 50% of the sick were vaccinated, but this is the wrong metric to look at! It is using the wrong denominator. It doesn’t take into account that <em>90%</em> of the population is vaccinated (yay!). <code>r tufte::margin_note('Even Bill Gates made this mistake when he said he\'d [rather encounter a shark than a mosquito](https://twitter.com/BillGates/status/1118196606975787008).')</code>This is called <em>flipping the conditional</em> (and is a problem that we see all the time!). Instead of looking at the probability of being vaccinated given you are sick, you want to look at the probability of being sick given you are vaccinated.</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2021-07-21/scenario-wrong.jpg" class="img-fluid"> What you need to do is look at the rates among the vaccinated and unvaccinated separately, and then compare them. Here 11% of the vaccinated got sick, 100% of the unvaccinated got sick.</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2021-07-21/scenario-right1.jpg" class="img-fluid"></p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2021-07-21/scenario-right2.jpg" class="img-fluid"></p>
<p>We calculate vaccine efficacy as</p>
<p>(risk among unvaccinated - risk among vaccinated) / risk among unvaccinated</p>
<p>so in this case, 89% (yay!)</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2021-07-21/scenario-effective.png" class="img-fluid"></p>
<p>So in sum, denominators matter! When scrolling past headlines, be sure to think about what denominators are in play!</p>



 ]]></description>
  <category>covid-19</category>
  <category>statistics</category>
  <guid>https://www.livefreeordichotomize.com/posts/2021-07-21-denominators-matter/index.html</guid>
  <pubDate>Wed, 21 Jul 2021 00:00:00 GMT</pubDate>
</item>
<item>
  <title>NYTimes Map How-to</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2021-04-07-nytimes-map-how-to/index.html</link>
  <description><![CDATA[ 




<p>There was a recent email thread in the <a href="https://ww2.amstat.org/committees/isostat/isostat.html">IsoStat listserv</a> about a cool visualization that recently came out in the New York Times showing COVID-19 cases over time. This sparked a discussion about whether this was possible to recreate in R with ggplot, so of course I gave it a try!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidycensus)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(geofacet)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(zoo)</span></code></pre></div>
</div>
<p>The plot shows cases per 100,000 by state, so I first needed to pull population data. To do that I used the <strong>tidycensus</strong> package. (If you don’t have an API key, you can get one <a href="https://api.census.gov/data/key_signup.html">here</a>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">census_api_key</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YOUR API KEY"</span>)</span></code></pre></div>
</div>
<p>I pulled the population by state from 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">pop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_acs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geography =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"state"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variables =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B01003_001"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span>)</span></code></pre></div>
</div>
<p>Then I pulled the cases in from the New York Times GitHub repo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">cases <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/nytimes/covid-19-data/raw/master/us-states.csv"</span>)</span></code></pre></div>
</div>
<p>These need to be wrangled a bit:</p>
<ul>
<li>The data come in as cumulative cases, and we want cases per day, so I create a new variable <code>case</code> for this purpose</li>
<li>There is a weirdo data point in Missouri on March 8th (it looks like there were 50,000 cases!) so I just removed that</li>
<li>I merged in the state populations that I pulled from the census</li>
<li>I created a 7 day rolling average</li>
<li>I created a variable for 7 day average per 100,000 people - this is the main variable used in the plot</li>
<li>I filtered to the range used in the original visualization - from Februrary 1st to April 4th</li>
<li>I merged in state abbreviations to make the plot easier to read</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cases <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(state) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">case =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(cases[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(cases))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021-03-08"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> state <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Missouri"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(pop, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fips"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GEOID"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(state) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">case_7 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rollmean</span>(case, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb5-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">case_per_100 =</span> (case_7 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> estimate) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021-01-31"</span>), date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021-04-05"</span>))</span>
<span id="cb5-14"></span>
<span id="cb5-15">states <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">state =</span> state.name,</span>
<span id="cb5-16">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">state_ =</span> state.abb) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-17">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">state =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"District of Columbia"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">state_ =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DC"</span>)</span>
<span id="cb5-18"></span>
<span id="cb5-19">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d, states, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"state"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(state_))</span></code></pre></div>
</div>
<p>This plot had a neat feature that it filled in the area from the lowest point onward; to replicate this I found the date with the minimum cases per 100,000 and created a variable <code>col</code> to indicate any date after this point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(state) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_min</span>(case_per_100) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min_date =</span> date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(min_date, state) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(d, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"state"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> min_date, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"no"</span>))</span></code></pre></div>
</div>
<p>Now time to plot! The x-axis is <code>date</code>, the y-axis is <code>case_per_100</code> and voila!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(d, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> case_per_100)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#BE2D22"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> col), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#BE2D22"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_alpha_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_geo</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>state_) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, </span>
<span id="cb7-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb7-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cases per 100,000"</span>,</span>
<span id="cb7-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feb 1 - Apr 4, Red area indicates rise since lowest point of 2021"</span>,</span>
<span id="cb7-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Note: Shows seven-day average"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2021-04-07-nytimes-map-how-to/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>



 ]]></description>
  <category>rstats</category>
  <category>nytimes</category>
  <category>covid-19</category>
  <guid>https://www.livefreeordichotomize.com/posts/2021-04-07-nytimes-map-how-to/index.html</guid>
  <pubDate>Wed, 07 Apr 2021 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Grided: a web-app for building css-grid layouts</title>
  <dc:creator>Nick Strayer</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2021-03-01-grided/index.html</link>
  <description><![CDATA[ 




<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Grided is an app that lets you define CSS-Grid layouts in a simple GUI allowing you to see how your app will look while you define it. The app is hosted at <a href="https://nickstrayer.me/grided/">nickstrayer.me/grided</a> and <a href="https://github.com/nstrayer/grided">the source is on github.</a></p>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>I have recently started a job at RStudio on the Shiny team. One of the things that I was brought on to do is “help Shiny user’s build more beautiful apps.” Because of this I have been working on a project allowing users to layout dashboard apps easily with the <a href="https://css-tricks.com/snippets/css/complete-guide-grid/">CSS-Grid specification.</a> CSS-Grid is a super powerful way of naturally declaring layouts but if you’re like me, the initial setup of getting your app going can be a bit cumbersome. Because of this I almost always reach for a tool like <a href="https://cssgrid-generator.netlify.app/">Sarah Drasner’s CSS grid generator</a> and <a href="https://grid.layoutit.com/">grid.layoutit</a>.</p>
<p>Inspired by both of these resources, I began working on a similar tool that can let Shiny user’s draw their desired layout and then get the code for that layout. After working on this project for a while, however, I realized that what I had built had a few features that I found useful compared to existing tools so I decided to spin off a purely JS/CSS version.</p>
</section>
<section id="goal" class="level2">
<h2 class="anchored" data-anchor-id="goal">Goal</h2>
<p>The goal of Grided is to simplify the very first part of building a grid-layout. You specify using a (hopefully) straightforward GUI how you want your app laid out and you get code to implement the structure you defined.</p>
</section>
<section id="usage" class="level2">
<h2 class="anchored" data-anchor-id="usage">Usage</h2>
<p><img src="https://www.livefreeordichotomize.com/media/grided/start-view.png" class="img-fluid"></p>
<p>The page starts with an empty grid layout. From here you can adjust the number of rows and columns along with the gap between those rows and columns. As you do this the faux app on the right updates in real time. Each column and row can be resized by a control form. <code>r tufte::margin_note("A fun hidden feature is that when you use the pixel-sizing a drag interface appears for resizing.")</code> For instance you can have a fixed-width sidebar.</p>
<p><img src="https://www.livefreeordichotomize.com/media/grided/custom-rows-cols.png" class="img-fluid"></p>
<p>Once you have your desired grid, you add your elements by clicking and dragging them on the grid. Once you have placed an element you provide its ID. Messed up where you placed it? Just drag it around with the supplied interaction handles to move it. <code>r tufte::margin_note("A little dashed box shows you the extent of your drag, while the element snaps to the grid.")</code></p>
<p><img src="https://www.livefreeordichotomize.com/media/grided/editing-element.png" class="img-fluid"></p>
<p>Decide you actually want a footer on your page after declaring a bunch of other stuff? No worries, simply add another row, your elements will stay where they are. Decide you don’t want a footer? Just remove a a row. If elements reside in the deleted row/column you will be asked how you want to update them in a popup.</p>
<p><img src="https://www.livefreeordichotomize.com/media/grided/conflicts-popup.png" class="img-fluid"> Happy with your layout and ready to get building your site? Click the “Get code” button in the top right and you will be provided the CSS and HTML code necessary to recreate your layout on your site.</p>
<p><img src="https://www.livefreeordichotomize.com/media/grided/get-layout-code.png" class="img-fluid"> <code>r tufte::margin_note("For the Shiny users, the main version of the app will give you R/Shiny code instead of CSS and HTML.")</code></p>
</section>
<section id="tech-specs" class="level2">
<h2 class="anchored" data-anchor-id="tech-specs">Tech-Specs</h2>
<p>There are a few fun facts about the app:</p>
<ul>
<li>Zero dependencies. The app is all just vanilla javascript and CSS. It even uses system fonts. The result: the whole app is only 47.5kb.</li>
<li>Written in <a href="https://www.typescriptlang.org/">typescript.</a> This is my very first typescript project and it worked pretty dang well.</li>
<li>Fast: After the resources are loaded it takes less than 10ms to completely render app to starting point.</li>
</ul>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<p>There are a few (to be kind) limitations right now:</p>
<ul>
<li>Only a few CSS units are supported. These are <code>fr</code>, <code>rem</code>, and <code>px</code>. CSS-Grid has some cool fancy options like <code>minmax()</code> but I couldn’t figure out how to build an interface like this for these dynamic layouts. <code>r tufte::margin_note("If you can think of one, let me know!")</code></li>
<li>No nested grids. There’s no reason in grid you cant but a grid-in-a-grid. My lame cop-out here is to just build your other grid-layout with the app and nest the html within the parent-layout’s exported code.</li>
<li>No mobile mode: If you want to change the layout for your app on mobile you basically have to build it twice and then use media queries (or the more gridy options like <code>repeat(autofit,...)</code>).</li>
</ul>


</section>

 ]]></description>
  <category>CSS</category>
  <category>website</category>
  <guid>https://www.livefreeordichotomize.com/posts/2021-03-01-grided/index.html</guid>
  <pubDate>Mon, 01 Mar 2021 00:00:00 GMT</pubDate>
</item>
<item>
  <title>How to build a DIY Lightboard</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2020-10-02-how-to-build-a-diy-lightboard/index.html</link>
  <description><![CDATA[ 





<div class="no-row-height column-margin column-container"><div class="">
<p>Here are some examples of my DIY lightboard in action! <br> * <a href="https://youtu.be/caThvcHkysc">How logging symptoms helps slow the virus spread</a><br> * <a href="https://youtu.be/fczR2ZOL_h8">Lucy D’Agostino McGowan discusses peer learning communities</a><br> * <a href="https://youtu.be/Z8jToqxnAeU">Law of Iterated Expectation</a></p>
</div></div><p>This summer in an effort to spruce up my home office and online statistics courses, I was in search of a simple solution that would let me walk through equations, as I normally would with a whiteboard in my office, remotely. Enter the <strong>lightboard</strong>! I <em>love</em> the aesthetic of these! They let you work through fun equations while still letting the viewer see your facial expressions, getting as close to an “in person” interaction as I’ve seen! The downside? They are super pricey! Some sites were quoting over $2,500 for the simpliest models. Even DIY “kits” were coming in at over $1,000 - yikes! Then I came across this <a href="https://www.youtube.com/watch?v=L1au1JxMSaA">amazing YouTube video</a> that lays out a simple DIY method that can be put together for <em>much</em> less - in fact, I was able to get my supplies together for less than $100. I put together a <a href="https://twitter.com/LucyStats/status/1285336981292163072">quick tweetorial</a> outlining the steps and the supplies I used; I thought I’d copy the contents here, since a blogpost is sometimes a bit easier to read!</p>
<section id="supplies" class="level2">
<h2 class="anchored" data-anchor-id="supplies">Supplies</h2>
<p><code>r emo::ji("white_large_square")</code> <a href="https://www.amazon.com/gp/product/B00C13ZSBA/">1/4 x 24 x 36 plexiglass</a><br>
<code>r emo::ji("bulb")</code> <a href="https://www.amazon.com/MINGER-Changing-Lighting-Flexible-Decoration/dp/B07JP5375R/">16ft of LED strip lights</a><br>
<code>r emo::ji("clamp")</code><a href="https://www.amazon.com/TEKTON-Malleable-C-Clamp-Opening-4011/dp/B000NY32AI">2 one inch C-clamps</a><br>
<code>r emo::ji("book")</code> <a href="https://www.amazon.com/STARVAST-Brackets-Floating-Supporter-250x160mm/dp/B07RHLZDL4/">4 bookshelf L brackets</a><br>
<code>r emo::ji("pen")</code> <a href="https://www.amazon.com/Quartet-Whiteboard-Assorted-Teachers-79551/dp/B008DQXN48/">neon markers</a></p>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><code>r emo::ji("bulb")</code> stick 3ft of the LED strip lights on a table<br>
<code>r emo::ji("point_up")</code> your plexiglass will sit on top of this</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2020-10-02/step1.jpeg" class="img-fluid"></p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p><code>r emo::ji("sandwich")</code> put your plexiglass between two of the shelf brackets on one side<br>
<code>r emo::ji("clamp")</code> fasten with the C-clamp<br>
<code>r emo::ji("repeat")</code> repeat on the other side</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2020-10-02/step2.jpeg" class="img-fluid"></p>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p><code>r emo::ji("bulb")</code> wrap the LED strip lights around the remainder of the plexiglass<br>
<code>r emo::ji("point_up")</code> I used a little tape to hold it on</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2020-10-02/step3.jpeg" class="img-fluid"></p>
</section>
<section id="step-4" class="level3">
<h3 class="anchored" data-anchor-id="step-4">Step 4</h3>
<p><code>r emo::ji("selfie")</code> set up camera<br>
<code>r emo::ji("partying_face")</code> use fun markers<br>
<code>r emo::ji("left_right_arrow")</code> flip video to mirror image</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2020-10-02/lightboard.gif" class="img-fluid"></p>


</section>
</section>

 ]]></description>
  <category>diy</category>
  <category>lightboard</category>
  <guid>https://www.livefreeordichotomize.com/posts/2020-10-02-how-to-build-a-diy-lightboard/index.html</guid>
  <pubDate>Fri, 02 Oct 2020 00:00:00 GMT</pubDate>
</item>
<item>
  <title>So you want to learn R…</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2020-07-02-so-you-want-to-learn-r/index.html</link>
  <description><![CDATA[ 




<p>There have been several twitter threads circulating with (free!) resources for learning R - I wanted to collect some of my favorites here. Thanks to <a href="https://twitter.com/jessicallavs">Jessica Lavery</a>, <a href="https://twitter.com/djnavarro">Danielle Navarro</a>, <a href="https://www.twitter.com/kellybodwin">Kelly Bodwin</a>, <a href="https://twitter.com/Jonthegeek">Jon Harmon</a>, <a href="https://twitter.com/tylermorganwall">Tyler Morgan-Wall</a>, <a href="https://twitter.com/rctatman">Rachael Tatman</a> for their awesome threads on these topics!</p>
<section id="beginnner" class="level2">
<h2 class="anchored" data-anchor-id="beginnner">Beginnner</h2>
<p><span style="font-size:30px"><strong>1. Teacup Giraffes and Stats [<a href="https://tinystats.github.io/teacups-giraffes-and-statistics">link</a>]</strong></span></p>
<section id="what-is-it" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it">What is it?</h3>
<p>This is a series of fabulous self-paced interactive modules by Hasse Walum and <a href="https://twitter.com/dcossyle">Desirée De Leon</a>. They begin by walking through the very basics of R and then teach basic statistics concepts such as measures of central tendency and variability, all with adorable illustrations of giraffes!</p>
</section>
<section id="this-is-good-for-you-if-you" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you">This is good for you if you</h3>
<ul>
<li>Learn best with self-paced interactive modules</li>
<li>Are a beginner interested in getting acquainted with the basics of R and statistics</li>
<li>Love giraffes</li>
</ul>
<p><span style="font-size:30px"><strong>2. Swirl [<a href="https://swirlstats.com/students.html">link</a>]</strong></span></p>
</section>
<section id="what-is-it-1" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-1">What is it?</h3>
<p>This is an R package that helps you learn R from <em>within</em> R. It’s an interactive course that runs from your R console!</p>
</section>
<section id="this-is-good-for-you-if-you-1" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-1">This is good for you if you</h3>
<ul>
<li>Learn best with self-paced learning-while-doing coding</li>
<li>Are a beginner interested in getting acquainted with the basics of R</li>
</ul>
<p><span style="font-size:30px"> <strong>3. RYouWithMe [<a href="https://rladiessydney.org/courses/ryouwithme/">link</a>]</strong></span></p>
</section>
<section id="what-is-it-2" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-2">What is it?</h3>
<p>This is a series of online learning resources for using R geared for beginners by <a href="https://twitter.com/williamslisaphd">Lisa Williams</a>, <a href="https://twitter.com/JenRichmondPhD">Jen Richmond</a>, and <a href="https://twitter.com/djnavarro">Danielle Navarro</a> as part of R-Ladies Sydney.</p>
</section>
<section id="this-is-good-for-you-if-you-2" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-2">This is good for you if you</h3>
<ul>
<li>Learn best with self-paced modules</li>
<li>Are interested in learning data science skills such as data wrangling and data visualization</li>
</ul>
<p><span style="font-size:30px"><strong>4. Adventures in R [<a href="https://www.adventures-in-r.com/">link</a>]</strong></span></p>
</section>
<section id="what-is-it-3" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-3">What is it?</h3>
<p>This is a college-level online course taught by <a href="https://www.twitter.com/kellybodwin">Kelly Bodwin</a> focusing on using R for Statistics and Data Science.</p>
</section>
<section id="this-is-good-for-you-if-you-3" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-3">This is good for you if you</h3>
<ul>
<li>Learn best with a structured of a full course</li>
<li>Have some knowledge of basic statistics and basic programming</li>
</ul>
<p><span style="font-size:30px"><strong>5. R4DataScience learning community [<a href="https://r4ds.io">link</a>] [<a href="https://r4ds.io/join">join</a>]</strong></span></p>
</section>
<section id="what-is-it-4" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-4">What is it?</h3>
<p>This is a learning community started by <a href="https://twitter.com/kierisi">Jessie Mostipak</a> that intitially went through Garret Grolemund and Hadley Wickham’s <a href="https://r4ds.had.co.nz/">R For Data Science</a> book. The group has since expanded to broadly welcome folks interested in learning R and / or improving their skills! The community is centered around a Slack group (<a href="https://r4ds.io/join">join here:</a>) and you can join as a learner or a mentor.</p>
</section>
<section id="this-is-good-for-you-if-you-4" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-4">This is good for you if you</h3>
<ul>
<li>Learn best in a community</li>
<li>Are looking for other folks interested in Data Science that use / are learning R</li>
</ul>
<p><span style="font-size:30px"><strong>6. Data Science: Foundations using R Specialization [<a href="https://www.coursera.org/specializations/data-science-foundations-r">link</a>]</strong> </span></p>
</section>
<section id="what-is-it-5" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-5">What is it?</h3>
<p>This is a Cousera course by the amazing JHU Data Science Lab team: Jeff Leek, Roger Peng, and Brian Caffo. This course will help you ask the right questions, manipulate data sets, and create visualizations to communicate results in R.</p>
</section>
<section id="this-is-good-for-you-if-you-5" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-5">This is good for you if you</h3>
<ul>
<li>Learn best with a structured full course</li>
<li>Are interested in beefing up your data science skills</li>
</ul>
<p><span style="font-size:30px"><strong>7. RStudio Primers [<a href="https://rstudio.cloud/learn/primers">link</a>]</strong></span></p>
</section>
<section id="what-is-it-6" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-6">What is it?</h3>
<p>These are interactive tutorials that teach everything from basic R skills to iterating and writing functions</p>
</section>
<section id="this-is-good-for-you-if-you-6" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-6">This is good for you if you</h3>
<ul>
<li>Learn best from self-paced interactive modules</li>
<li>Are interested in learning everything from the basics in R to more advanced skill</li>
</ul>
<p><span style="font-size:30px"><strong>8.</strong> <em>Suggested by <a href="https://twitter.com/GiulioCentorame">Giulio Centorame</a></em> <strong>Ready for R [<a href="https://ready4r.netlify.app/">link</a>]</strong></span></p>
</section>
<section id="what-is-it-7" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-7">What is it?</h3>
<p>A course by <a href="https://twitter.com/tladeras">Ted Laderas</a> meant to be a gentle introduction to using R/Rstudio in your daily work.</p>
</section>
<section id="this-is-good-for-you-if-you-7" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-7">This is good for you if you</h3>
<ul>
<li>Learn best from a self-paced online course</li>
<li>Are interested in learning the basics of R and RStudio</li>
</ul>
</section>
</section>
<section id="a-little-past-beginner" class="level2">
<h2 class="anchored" data-anchor-id="a-little-past-beginner">A little past beginner</h2>
<p><span style="font-size:30px"><strong>1. Creating dynamic dashboards with the shinydashboard R package [<a href="https://leanpub.com/c/shinydashboard">link</a>]</strong></span></p>
<section id="what-is-it-8" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-8">What is it?</h3>
<p>An online course (by me!) on the shinydashboard package. This expects you know a <em>bit</em> about R and shiny, but aimed mostly at beginner / intermediate users.</p>
</section>
<section id="this-is-good-for-you-if-you-8" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-8">This is good for you if you</h3>
<ul>
<li>Learn best with self-paced modules</li>
<li>Are looking to build a simple, dynamic dashboard in R.</li>
</ul>
<p><span style="font-size:30px"><strong>2. Text Mining with R: A Tidy Approach [<a href="https://tidytextmining.com">link</a>]</strong></span></p>
</section>
<section id="what-is-it-9" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-9">What is it?</h3>
<p>This <a href="https://twitter.com/rctatman">Rachael Tatman</a> described this as a “code-along” - I love that description! This book by <a href="https://twitter.com/JuliaSilge">Julia Silge</a> and <a href="https://twitter.com/drob">David Robinson</a> is a great introduction to text mining the tidy way!</p>
</section>
<section id="this-is-good-for-you-if-you-9" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-9">This is good for you if you</h3>
<ul>
<li>Learn best working through a self-pased book</li>
<li>Are interested in natural language processing</li>
</ul>
<p><span style="font-size:30px"><strong>3. MasterClass Featuring Tyler Morgan-Wall: 3D Mapping and Dataviz in R [<a href="https://penniur.upenn.edu/events/musamasterclass-featuring-tyler-morgan-wall-3d-mapping-dataviz-in-r">link</a>]</strong></span></p>
</section>
<section id="what-is-it-10" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-10">What is it?</h3>
<p>A video-lecture by <a href="https://twitter.com/tylermorganwall">Tyler Morgan-Wall</a> on making 3D maps in R with rayshader.</p>
</section>
<section id="this-is-good-for-you-if-you-10" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-10">This is good for you if you</h3>
<ul>
<li>Learn best from video lectures</li>
<li>Are interested in 3D visualizations in R</li>
</ul>
<p><span style="font-size:30px"><strong>4.</strong> <em>Suggested by <a href="https://twitter.com/AkhondiAsl">Alireza Akhondi-asl</a></em> <strong>Interactive web-based data visualization with R, plotly, and shiny [<a href="https://plotly-r.com">link</a>]</strong></span></p>
</section>
<section id="what-is-it-11" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-11">What is it?</h3>
<p>A book by <a href="https://twitter.com/cpsievert">Carson Sievert</a> describing how to create interactive visualizations in R.</p>
</section>
<section id="this-is-good-for-you-if-you-11" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-11">This is good for you if you</h3>
<ul>
<li>Learn best working through a self-paced book</li>
<li>Are interested in creating interactive visualizations</li>
</ul>
<p><span style="font-size:30px"><strong>5.</strong> <em>Suggested by <a href="https://twitter.com/lisalendway">Lisa Lendway</a></em> <strong>Getting Started with Tidymodels [<a href="https://www.tidymodels.org/start/">link</a>]</strong> </span></p>
</section>
<section id="what-is-it-12" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-12">What is it?</h3>
<p>An set of modules by RStudio focused on the tidymodels package.</p>
</section>
<section id="this-is-good-for-you-if-you-12" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-12">This is good for you if you</h3>
<ul>
<li>Learn best working through self-paced coding modules</li>
<li>Are interested in learning advanced statistical modeling in R</li>
</ul>
<p><span style="font-size:30px"><strong>6.</strong> <em>Suggested by <a href="https://twitter.com/lisalendway">Lisa Lendway</a> and <a href="https://twitter.com/alexpghayes">Alex Hayes</a></em> <strong>Tidy machine learning in R [<a href="https://www.rebeccabarter.com/blog/2020-03-25_machine_learning/">link</a>]</strong></span></p>
</section>
<section id="what-is-it-13" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-13">What is it?</h3>
<p>A tutorial code-along by <a href="https://twitter.com/rlbarter">Rebecca Barter</a> on machine learning focusing on the tidymodels package.</p>
</section>
<section id="this-is-good-for-you-if-you-13" class="level3">
<h3 class="anchored" data-anchor-id="this-is-good-for-you-if-you-13">This is good for you if you</h3>
<ul>
<li>Learn best working through self-paced code-alongs</li>
<li>Are interested in learning advanced statistical modeling in R</li>
</ul>
<p><strong>Did I miss one of your favorites? Please let me know!</strong></p>


</section>
</section>

 ]]></description>
  <category>rstats</category>
  <guid>https://www.livefreeordichotomize.com/posts/2020-07-02-so-you-want-to-learn-r/index.html</guid>
  <pubDate>Thu, 02 Jul 2020 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Survival Model Detective: Part 2</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index.html</link>
  <description><![CDATA[ 




<p>A <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa2007016">paper by Grein et al.&nbsp;was recently published in the New England Journal of Medicine</a> examining a cohort of patients with COVID-19 who were treated with compassionate-use remdesivir. There are two things that were interesting about this paper:</p>
<ol type="1">
<li>They had a very neat figure that included tons of information about their cohort</li>
<li>The primary statistical analysis was not appropriately done</li>
</ol>
<p>Check out #1 in the <a href="https://livefreeordichotomize.com/2020/05/21/survival-model-detective-1/">Part 1</a> post. This post focuses on #2, in particular it focuses on <em>competing risks</em>. This criticism was made by Stefanos Bonovas and Daniele Piovani in a <a href="https://www.nejm.org/doi/full/10.1056/NEJMc2015312?source=nejmtwitter&amp;medium=organic-social">letter to the Editor</a> a few days ago.</p>
<section id="what-is-their-question" class="level2">
<h2 class="anchored" data-anchor-id="what-is-their-question">What is their question?</h2>
<p>I believe the authors are interested in telling us about <em>clinical improvement</em> in this cohort of patients taking remdesivir, in particular they want to estimate the cumulative incidence of clinical improvement by 28 days. For the purposes of their analysis “clinical improvement” is defined as being discharged alive or having a decrease of 2 points or more in a 6-level ordinal scale of oxygen support:</p>
<ul>
<li>ECMO<br>
</li>
<li>Mechanical ventilation<br>
</li>
<li>NIPPV<br>
</li>
<li>High-flow oxygen<br>
</li>
<li>Low-flow oxygen</li>
<li>Ambient air</li>
</ul>
<p>They use a Kaplan Meier plot to show this. Let’s recreate it first.</p>
</section>
<section id="recreate-their-plots" class="level2">
<h2 class="anchored" data-anchor-id="recreate-their-plots">Recreate their plots</h2>
<p>I spent <a href="https://github.com/LucyMcGowan/nejm-grein-reanalysis">some time trying to recreate their analysis</a> using the data from Figure 2, and I wasn’t quite about to do it. So I’ve painstakingly pulled every number from Figure 3A 😅</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(survival)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(survminer)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(cowplot)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(cmprsk)</span>
<span id="cb1-6">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/LucyMcGowan/nejm-grein-reanalysis/master/data/data-fig-2.csv"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">fig_3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb2-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,</span>
<span id="cb2-3">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,</span>
<span id="cb2-4">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, </span>
<span id="cb2-5">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, </span>
<span id="cb2-6">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span>),</span>
<span id="cb2-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-8">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb2-9">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb2-10">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-11">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-12">)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">survfit</span>(</span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Surv</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> event) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb3-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> fig_3</span>
<span id="cb3-4">)</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsurvplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fit =</span> s, </span>
<span id="cb3-7">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">risk.table =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, </span>
<span id="cb3-8">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">break.time.by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb3-9">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">risk.table.y.text =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb3-10">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days"</span>,</span>
<span id="cb3-11">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tables.theme =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_cleantable</span>(),</span>
<span id="cb3-12">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"event"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I haven’t quite figured out how to map these back to Figure 2, but it seems it replicates Figure 3A pretty well. Let’s estimate the cumulative incidence at 28 days:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">s_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb4-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> s<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb4-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cumulative_incidence =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> s<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>surv</span>
<span id="cb4-4">)</span>
<span id="cb4-5">s_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
   time cumulative_incidence
  &lt;dbl&gt;                &lt;dbl&gt;
1    28                0.841</code></pre>
</div>
</div>
<p>Looks very similar to the 84% reported in the initial paper. Cool, what’s the problem? The idea main idea is to examine time to clinical improvement and assess at 28 days what the cumulative incidence of improvement is. The way a typical survival analysis (like the ones the authors did here) works is typically you follow a group of patients for a certain amount of time. If they have an <em>event</em> (for example in the analysis above if they <em>improve</em>) you record them as such and the time the event occurred, otherwise you <em>censor</em> them and record the final time they were observed. In the figure here we have 33 patients that <em>improved</em> and 20 that were censored. Sounds fine, what’s the problem? A key assumption is that censoring should be “non-informative”, in other words, the patient is followed for a certain amount of time, never has the event, and then is no longer followed. Our best guess is that we <em>know</em> they didn’t have the event up until the last day we saw them, so we <em>censor</em> them on that day. Maybe they’ll have the event the next day, or maybe in a year - in order for the assumptions to be appropriately met, it must be the case that patients who have been censored are just as likely to have the event as those who are still being followed in the study. Let’s pull up Figure 2 again.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>7 of the patients in this cohort <em>died</em>. If someone <em>dies</em> we know that they are not going to <em>improve</em> later. This is not non-informative censoring!! Luckily there is a very straightforward way to deal with this in statistics - competing risks!</p>
</section>
<section id="competing-risks" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="competing-risks">Competing Risks</h2>
<p>In a competing risk analysis, we can separate out the the <em>death</em> outcome from the remaining <em>censored</em> outcomes. We can then appropriately estimate the cumulative incidence of <em>improving</em>. I’ve recoded the 7 deaths (guessed from Figure 2) below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">fig_3_fixed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb6-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,</span>
<span id="cb6-3">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,</span>
<span id="cb6-4">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, </span>
<span id="cb6-5">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, </span>
<span id="cb6-6">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span>),</span>
<span id="cb6-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb6-8">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-9">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb6-10">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-11">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-12">)</span></code></pre></div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Interested in learning more about competing risk analyses in R? <a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html#cumulative_incidence_for_competing_risks">Emily Zabor has an amazing tutorial on this</a></p>
</div></div><p>Let’s see how the plot looks now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cuminc</span>(fig_3_fixed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb7-2">            fig_3_fixed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event, </span>
<span id="cb7-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cencode =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggcompetingrisks</span>(x, </span>
<span id="cb7-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Improvement Improvement"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Death Death"</span>),</span>
<span id="cb7-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggtheme =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>())</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ok, let’s calculate the cumulative incidence now, taking death into account.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"est"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"var"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 1"</span>), time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  id     time   est     var
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 1 1      28 0.734 0.00612</code></pre>
</div>
</div>
<p>The estimated cumulative incidence of clinical improvement by day 28 is 73%. Here’s two plots that show the difference.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Why does this matter? It’s crucial that the questions we answer statistically match the ones we are posing in practice. Understanding the underlying assumptions of the models is so important!</p>
</section>
<section id="figure-3b" class="level2">
<h2 class="anchored" data-anchor-id="figure-3b">Figure 3B</h2>
<p>It turns out <em>really</em> this is a story about Figure 3B. Why? Because 6/7 of the patients who died were on invasive oxygen support at baseline, so modeling this correctly has the largest impact on the <em>Invasive</em> line on this plot. Here they were examining the same outcome, stratifying by whether patient had <em>invasive</em> or <em>noninvasive</em> baseline oxygen support.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">fig_3_fixed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb10-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,</span>
<span id="cb10-3">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,</span>
<span id="cb10-4">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, </span>
<span id="cb10-5">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, </span>
<span id="cb10-6">           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span>),</span>
<span id="cb10-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb10-8">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb10-9">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb10-10">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb10-11">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb10-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">invasive =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb10-13">               <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb10-14">               <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb10-15">               <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb10-16">               <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-17">)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">survfit</span>(</span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Surv</span>(time, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(event <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> invasive, </span>
<span id="cb11-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> fig_3_fixed</span>
<span id="cb11-4">)</span>
<span id="cb11-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsurvplot</span>(</span>
<span id="cb11-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fit =</span> fit, </span>
<span id="cb11-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">risk.table =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb11-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">break.time.by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb11-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">risk.table.y.text =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb11-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>),</span>
<span id="cb11-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tables.theme =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_cleantable</span>(),</span>
<span id="cb11-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb11-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"event"</span>,</span>
<span id="cb11-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.labs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Noninvasive"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Invasive"</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now what happens if we do a competing risks model? Let’s see what that looks like now</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cuminc</span>(fig_3_fixed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time, </span>
<span id="cb12-2">            fig_3_fixed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>event, </span>
<span id="cb12-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> fig_3_fixed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>invasive,</span>
<span id="cb12-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cencode =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggcompetingrisks</span>(x, </span>
<span id="cb13-2">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb13-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Noninvasive Improvement"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Invasive Improvement"</span>,</span>
<span id="cb13-4">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Noninvasive Death"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Invasive Death"</span>),</span>
<span id="cb13-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggtheme =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>(),</span>
<span id="cb13-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We wouldn’t expect the <em>Noninvasive</em> group to change much, because only one patient in this stratum died. Let’s focus instead on just the <em>Invasive</em> group to compare how that line changes with a proper analysis.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Basically, all this is to say that a competing risk analysis would have been more appropriate here. Hopefully this code-through has been helpful!</p>


</section>

 ]]></description>
  <category>rstats</category>
  <category>covid-19</category>
  <category>survival analysis</category>
  <category>competing risks</category>
  <guid>https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-2/index.html</guid>
  <pubDate>Fri, 22 May 2020 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Survival Model Detective: Part 1</title>
  <dc:creator>Lucy D&#39;Agostino McGowan</dc:creator>
  <link>https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-1/index.html</link>
  <description><![CDATA[ 




<p>A <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa2007016">paper by Grein et al.&nbsp;was recently published in the New England Journal of Medicine</a> examining a cohort of patients with COVID-19 who were treated with compassionate-use remdesivir. There are two things that were interesting about this paper:</p>
<ol type="1">
<li>They had a very neat figure that included tons of information about their cohort</li>
<li>The primary statistical analysis was not appropriately done</li>
</ol>
<p>This post focuses on the very neat figure!</p>
<section id="figure-2" class="level2">
<h2 class="anchored" data-anchor-id="figure-2">Figure 2</h2>
<p>Figure 2 in the original paper shows the changes in oxygen-support status from baseline for each of the 53 patients. This figure includes information about:</p>
<ul>
<li>The duration of follow up for each individual patient</li>
<li>Each patient’s oxygen trajectory</li>
<li>Each patient’s ultimate outcome (death, discharged, censored)</li>
</ul>
<p>You can construct a whole dataset from this (and I did!) - you can find it <a href="https://github.com/LucyMcGowan/nejm-grein-reanalysis">on my GitHub</a>.</p>
<p><img src="https://www.livefreeordichotomize.com/media/images/2020-05-21/fig2.png"></p>
<p>Below is code to recreate their Figure 2 using #rstats 😎.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/LucyMcGowan/nejm-grein-reanalysis/master/data/data-fig-2.csv"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">long_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(day_1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>day_36)</span>
<span id="cb2-3"></span>
<span id="cb2-4">cats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb2-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,</span>
<span id="cb2-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cat =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ambient air"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Low-flow oxygen"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"High-flow oxygen"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NIPPV"</span>, </span>
<span id="cb2-7">                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mechanical ventilation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ECMO"</span>),</span>
<span id="cb2-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ECMO"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mechanical ventilation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NIPPV"</span>, </span>
<span id="cb2-9">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"High-flow oxygen"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Low-flow oxygen"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ambient air"</span>))</span>
<span id="cb2-10">)</span>
<span id="cb2-11">long_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(cats, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">day_oxy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, name)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb2-15">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">day_oxy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(day_oxy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, day_oxy),</span>
<span id="cb2-16">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">day =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, day),</span>
<span id="cb2-17">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">patient =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(patient, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">53</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb2-18">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">event =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(event <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"censor"</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, event)</span>
<span id="cb2-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> patient, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> day_oxy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> cat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> patient, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> patient,</span>
<span id="cb2-22">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Oxygen support"</span>,</span>
<span id="cb2-25">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#7D3A2C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#AA3B2F"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#D36446"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#DEA568"</span>, </span>
<span id="cb2-26">                               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F5D280"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FCEEBC"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> patient, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> day <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> event)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_shape_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Event"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb2-29">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Death"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Discharge"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-1/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I definitely applaud the authors for making this so accessible! Check out <a href="https://livefreeordichotomize.com/2020/05/22/survival-model-detective-2/">Part 2</a> to see a bit about how their statistics could be improved.</p>


</section>

 ]]></description>
  <category>rstats</category>
  <category>covid-19</category>
  <category>survival analysis</category>
  <category>competing risks</category>
  <guid>https://www.livefreeordichotomize.com/posts/2020-05-21-survival-model-detective-1/index.html</guid>
  <pubDate>Thu, 21 May 2020 00:00:00 GMT</pubDate>
</item>
</channel>
</rss>
