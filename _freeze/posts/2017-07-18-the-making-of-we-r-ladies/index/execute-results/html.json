{
  "hash": "bea03b715b40f74bffe33ede42479087",
  "result": {
    "markdown": "---\ntitle: The making of \"We R-Ladies\"\nauthor: \"Lucy D'Agostino McGowan and MaÃ«lle Salmon\"\ndate: '2017-07-18'\nslug: the-making-of-we-r-ladies\ncategories: [rstats, rladies]\ntags: [rstats, rladies]\ndescription: \"MaÃ«lle and I created a mosaic of R-Ladies for the JSM Data Art Show. Here is a quick tutorial if you are interested in trying something similar!\"\n---\n\n\nLast March [MaÃ«lle](https://twitter.com/ma_salmon) wrote a blog post [\"Faces of #rstats Twitter\"](http://www.masalmon.eu/2017/03/19/facesofr/), a great tutorial on scraping twitter photos and compiling them in a collage. This inspired a similar adventure, but for #RLadies!\n\n::: column-margin\n<a href=\"../../media/images/first-pass-rladies-collage.jpeg\">\n<img class = \"img-responsive\" src=\"../../media/images/first-pass-rladies-collage.jpeg\" alt=\"First pass\" style=\"width:100%\">\n</img></a>\nOne of our early brainstorm ideas, as MaÃ«lle pointed out, looks a bit more like a kniting pattern.\n:::\n\nWe brainstormed different ways we could make this collage unique, but ultimilately landed on creating a mosaic with the R-Ladies logo.\n\nWe first wanted to use Twitter profile pics but even after launching a small campaign we realized we'd identify too few R-Ladies to fill a collage. Therefore we mixed two information sources:\n\n* For the collage itself we decided on using Meetup data, which was made even cooler by the fact that the [`meetupr` package](https://github.com/rladies/meetupr) was developed by R-Ladies in the R-Ladies Github organization!  \n* For the frame of the collage we chose to use the R-Ladies identified via Twitter.\n\n```r\nlibrary(\"dplyr\")\n## devtools::install_github(\"rladies/meetupr\")\nlibrary(\"meetupr\")\nlibrary(\"magick\")\nlibrary(\"rtweet\")\n```\n\n## Pull in Meetup data\n\nTo get all of our current Meetups, we scrape our [R-Ladies GitHub](https://github.com/rladies) data.\n```r\ndoc.raw <- RCurl::getURL(\"https://raw.githubusercontent.com/rladies/starter-kit/master/Current-Chapters.md\")\nmeetups <- stringr::str_match_all(doc.raw, \"www.meetup.com/(.*?)/\")[[1]][,2]\nmeetups <- unique(meetups)\n```\n\nWe use our `meetupr` package to pull profile pictures of all of our members.\n\n::: column-margin\nIf you would like to follow along, you can grab a [Meetup API Key](https://secure.meetup.com/meetup_api/key/).\n:::\n\n```r\napi_key <- \"YOUR_MEETUP_API_KEY\"\n```\n\nHere are a few small functions to get and save the Meetup photos.\n\n```r\nget_photos <- function(i,meetup){\n  members <- try(get_members(meetup[i], api_key), silent = TRUE)\n  if(class(members)[1] != \"try-error\"){\n    members %>%\n      purrr::map(.,\"photo\", .null = NA) %>%\n      purrr::map_chr(., \"photo_link\", .null = NA)\n  }\n}\n\nsave_image <- function(photo){\n  image <- try(image_read(photo), silent = TRUE)\n  if(class(image)[1] != \"try-error\"){\n    image <- image %>%\n      image_scale(\"100x100!\") %>%\n      image_write(\n        paste0(\n          \"meetup-data/\",\n          stringr::str_match(photo[1], \"member_(.*?)\\\\.\")[, 2],\n          \".jpg\"\n        ),\n        format = \"jpeg\"\n      )\n  }\n  \n}\n```\n\nGrab the photos for each Meetup group.\n\n```r\npics <- purrr::map(1:length(meetups),\n                       get_photos,\n                       meetup = meetups\n                       ) %>%\n                       unlist()\n```\n\nNow walk it out ðŸ’ƒ.\n\n```r\npurrr::walk(pics, save_image)\n```\n\n## Remove the default avatars\n\nThere are a few photos that are the default avatar. These have a grey color with a white center. To check if this is the case, test whether the first column of pixels is fully grey.\n\n::: column-margin\nThis removed ~200 photos.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndir <- dir(\"meetup-data\", full.names = TRUE)\n\ncheck_image <- function(pic) {\n  img <- jpeg::readJPEG(pic)\n  if (any(dim(img) == 3)) {\n    if (length(unique(img[,1,1])) == 1) {\n      file.remove(pic)\n    }\n  }\n}\n\npurrr::walk(dir, check_image)\n```\n:::\n\n\n\n## Make into a mosaic!\n\nWe use [`RsimMosaic`](https://cran.r-project.org/web/packages/RsimMosaic/index.html), but had to tweak a few things (there were a few pictures causing errors making the whole thing break, so I added some error catching as well as the abilitity to specify the input tile size).\n\n```r\n## devtools::install_github(\"LucyMcGowan/RsimMosaic\")\nlibrary(\"RsimMosaicLDM\")\n```\n\n```r\nset.seed(108)\ncomposeMosaicFromImageRandomOptim(\n  originalImageFileName = \"RLadies_tofill.jpeg\",\n  outputImageFileName = \"art-ladies.jpg\",\n  inputTileSize = 100,\n  imagesToUseInMosaic = \"meetup-data\", \n  removeTiles = TRUE,\n  fracLibSizeThreshold = 0.01\n  )\n```\n\nWe used 9106 unique tiles to create the image using K-nearest neighbors to select the optimal match.\n\n## Pull in the Twitter data\n\n```r\ndat <- search_tweets(q = '#RLadies', n = 1000, include_rts = FALSE)\ntweets <- users_data(dat) %>%\n  select(screen_name, profile_image_url)\nusers <- search_users(\"#RLadies\", n = 1000) %>%\n  select(screen_name, profile_image_url)\n\nprof <- unique(rbind(tweets, users))\n```\n\n::: column-margin \nWe removed a few accounts that we know are not actually (our version of) R-Ladies accounts.\n:::\n\n```r\nprof <- prof[!(prof$screen_name %in%\n  c(\"Junior_RLadies\",\n  \"RLadies_LF\",\n  \"WomenRLadies\",\n  \"Rstn_RLadies13\",\n  \"RLadies\",\n  \"RnRladies\")\n  ), ]\n```\n\nHere is a function to save the images. We are using the twitter images as the frame, so they are larger than the Meetup images.\n\n```r\nsave_image <- function(df){\n  image <- try(image_read(sub(\"_normal\", \"\", df$profile_image_url)), silent = TRUE)\n  if(class(image)[1] != \"try-error\"){\n    image %>%\n      image_scale(\"500x500\") %>%\n      image_write(paste0(\"tweet-data/\", df$screen_name, \".jpg\"), format = \"jpeg\")\n  }\n  \n}\n\nusers <- split(prof, 1:nrow(prof))\npurrr::walk(users, save_image)\n```\n\nNow let's randomly read them in!\n```r\nset.seed(525)\npics <- dir(\"tweet-data\", full.names = TRUE)\npics <- sample(pics, length(pics))\n```\n\n::: column-margin\nWe removed a few of the chapter accounts to ensure an even number.\n:::\n\n```r\n## we need a multiple of 4\nrladies_chapters <- which(grepl(\"RLadies\", pics)) \npics <- pics[-rladies_chapters[1:2]]\n```\n\n## Create the frame\n\nCreate the top of the frame ðŸŽ‰.\n```r\nlength_size <- length(pics)/4\npics[1:length_size] %>%\n  image_read() %>%\n  image_append(stack = FALSE) %>%\n  image_write(\"frame/top.jpg\")\n```\n\nCreate the bottom of the frame ðŸ‘‡.\n```r\npics[(length_size + 1):(length_size * 2)] %>%\n  image_read() %>%\n  image_append(stack = FALSE) %>%\n  image_write(\"frame/bottom.jpg\")\n```\n\nCreate the left side of the frame ðŸ‘ˆ.\n```r\npics[(length_size * 2 + 1):(length_size * 3)] %>%\n  image_read() %>%\n  image_append(stack = TRUE) %>%\n  image_write(\"frame/left.jpg\")\n```\n\nCreate the right side of the frame ðŸ‘‰.\n```r\npics[(length_size * 3 + 1):length(pics)] %>%\n  image_read() %>%\n  image_append(stack = TRUE) %>%\n  image_write(\"frame/right.jpg\")\n```\n\nWe add small R-Ladies logos to the sides of the frame!\n```r\nlogo_url <- \"https://raw.githubusercontent.com/rladies/starter-kit/master/logo/R-LadiesGlobal_RBG_online_LogoOnly.png\"\n\nimage_read(logo_url) %>%\n  image_scale(\"500x500+0+0\") %>%\n  image_write(\"frame/logo_small.jpg\")\n\nht <- image_read(\"art-ladies.jpg\") %>% \n  image_info %>% \n  select(height)\n  \ndims <- paste0(ht, \"x\", ht, \"+0+0\")\n```\n\nPut it all together! ðŸŽ¨\n```r\nc(\"frame/bottom.jpg\") %>%\n  image_read() %>%\n  image_append(stack = FALSE) %>%\n  image_scale(geometry = dims) %>%\n  image_write(\"frame/good_bottom.jpg\")\n\nc(\"frame/top.jpg\") %>%\n  image_read() %>%\n  image_append(stack = FALSE) %>%\n  image_scale(geometry = dims) %>%\n  image_write(\"frame/good_top.jpg\")\n\nc(\"frame/good_top.jpg\", \"art-ladies.jpg\",\n  \"frame/good_bottom.jpg\") %>%\n  image_read() %>%\n  image_append(stack = TRUE) %>%\n  image_write(\"test_topbottom.jpg\")\n\nht <- image_read(\"test_topbottom.jpg\") %>% \n  image_info %>% \n  select(height)\n  \ndims <- paste0(ht, \"x\", ht, \"+0+0\")\n\nc(\"frame/logo_small.jpg\", \n  \"frame/left.jpg\",\n  \"frame/logo_small.jpg\") %>%\n  image_read() %>%\n  image_append(stack = TRUE) %>%\n  image_scale(geometry = dims) %>%\n  image_write(\"frame/good_left.jpg\")\n\nc(\"frame/logo_small.jpg\", \n  \"frame/right.jpg\",\n  \"frame/logo_small.jpg\") %>%\n  image_read() %>%\n  image_append(stack = TRUE) %>%\n  image_scale(geometry = dims) %>%\n  image_write(\"frame/good_right.jpg\")\n\nc(\"frame/good_left.jpg\", \"test_topbottom.jpg\",\n  \"frame/good_right.jpg\") %>%\n  image_read() %>%\n  image_append(stack = FALSE) %>%\n  image_write(\"we-r-ladies.png\")\n```\n<a href=\"/images/we-r-ladies.jpeg\">\n<img class = \"image-responsive\" src = \"/images/we-r-ladies.jpeg\"> </img></a>\n\nAttending JSM? Come see our work on display at the [Data Art Show](https://ww2.amstat.org/meetings/jsm/2017/dataartshow.cfm)! And since participating makes us real _data artists_ now, find below the \"artsy\" description of our work!\n\n_R-Ladies is a global organization focused on improving gender diversity in the R community. R is an open-source statistics programming language. We used an R-Ladies developed package, meetupr to pull several thousand profile pictures from 33 R-Ladies meetups. We then used k-nearest neighbors to optimally match each image to a pixel of the R logo. The frame is comprised of Twitter profile pictures of individuals and local chapters who used the hashtag #RLadies in the days prior to our data collection. Pictures were assembled thanks to rOpenSciâ€™s magick package. This work symbolizes how the global R-Ladies community is composed of diverse individuals attending events and communicating about the organization, whose strengths add up and create a strong grassroots organization. The whole creation process was carried out using R, showing the diversity of the language itself, and making the most of a tool, meetupr, created by members of the R-Ladies community, further underlining the synergy we want to convey. All in all, We R-Ladies is a tribute to diversity in the R community._\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}